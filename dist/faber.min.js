function MediumEditor(e,t){"use strict";return this.init(e,t)}"object"==typeof module&&(module.exports=MediumEditor),function(e,t){"use strict";function n(e,t){var n;if(void 0===e)return t;for(n in t)t.hasOwnProperty(n)&&e.hasOwnProperty(n)===!1&&(e[n]=t[n]);return e}function o(){var t,n,o,i=e.getSelection();if(i.getRangeAt&&i.rangeCount){for(o=[],t=0,n=i.rangeCount;n>t;t+=1)o.push(i.getRangeAt(t));return o}return null}function i(t){var n,o,i=e.getSelection();if(t)for(i.removeAllRanges(),n=0,o=t.length;o>n;n+=1)i.addRange(t[n])}function r(){var e=t.getSelection().anchorNode,n=e&&3===e.nodeType?e.parentNode:e;return n}function a(){var n,o,i,r,a="";if(void 0!==e.getSelection){if(o=e.getSelection(),o.rangeCount){for(r=t.createElement("div"),n=0,i=o.rangeCount;i>n;n+=1)r.appendChild(o.getRangeAt(n).cloneContents());a=r.innerHTML}}else void 0!==t.selection&&"Text"===t.selection.type&&(a=t.selection.createRange().htmlText);return a}function s(e){return!(!e||1!==e.nodeType)}MediumEditor.prototype={defaults:{allowMultiParagraphSelection:!0,anchorInputPlaceholder:"Paste or type a link",anchorPreviewHideDelay:500,buttons:["bold","italic","underline","anchor","header1","header2","quote"],buttonLabels:!1,checkLinkFormat:!1,cleanPastedHTML:!1,delay:0,diffLeft:0,diffTop:-10,disableReturn:!1,disableDoubleReturn:!1,disableToolbar:!1,disableEditing:!1,elementsContainer:!1,firstHeader:"h3",forcePlainText:!0,placeholder:"Type your text",secondHeader:"h4",targetBlank:!1,extensions:{},activeButtonClass:"medium-editor-button-active",firstButtonClass:"medium-editor-button-first",lastButtonClass:"medium-editor-button-last"},isIE:"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent),init:function(e,o){return this.setElementSelection(e),0!==this.elements.length?(this.parentElements=["p","h1","h2","h3","h4","h5","h6","blockquote","pre"],this.id=t.querySelectorAll(".medium-editor-toolbar").length+1,this.options=n(o,this.defaults),this.setup()):void 0},setup:function(){this.isActive=!0,this.initElements().bindSelect().bindPaste().setPlaceholders().bindWindowActions()},initElements:function(){this.updateElementList();var e,n=!1;for(e=0;e<this.elements.length;e+=1)this.options.disableEditing||this.elements[e].getAttribute("data-disable-editing")||this.elements[e].setAttribute("contentEditable",!0),this.elements[e].getAttribute("data-placeholder")||this.elements[e].setAttribute("data-placeholder",this.options.placeholder),this.elements[e].setAttribute("data-medium-element",!0),this.bindParagraphCreation(e).bindReturn(e).bindTab(e),this.options.disableToolbar||this.elements[e].getAttribute("data-disable-toolbar")||(n=!0);return n&&(this.options.elementsContainer||(this.options.elementsContainer=t.body),this.initToolbar().bindButtons().bindAnchorForm().bindAnchorPreview()),this},setElementSelection:function(e){this.elementSelection=e,this.updateElementList()},updateElementList:function(){this.elements="string"==typeof this.elementSelection?t.querySelectorAll(this.elementSelection):this.elementSelection,1===this.elements.nodeType&&(this.elements=[this.elements])},serialize:function(){var e,t,n={};for(e=0;e<this.elements.length;e+=1)t=""!==this.elements[e].id?this.elements[e].id:"element-"+e,n[t]={value:this.elements[e].innerHTML.trim()};return n},callExtensions:function(e){if(!(arguments.length<1)){var t,n,o=Array.prototype.slice.call(arguments,1);for(n in this.options.extensions)this.options.extensions.hasOwnProperty(n)&&(t=this.options.extensions[n],void 0!==t[e]&&t[e].apply(t,o))}},bindParagraphCreation:function(e){var n=this;return this.elements[e].addEventListener("keypress",function(e){var n,o=r();32===e.which&&(n=o.tagName.toLowerCase(),"a"===n&&t.execCommand("unlink",!1,null))}),this.elements[e].addEventListener("keyup",function(e){var o,i=r();i&&i.getAttribute("data-medium-element")&&0===i.children.length&&!n.options.disableReturn&&!i.getAttribute("data-disable-return")&&t.execCommand("formatBlock",!1,"p"),13===e.which&&(i=r(),o=i.tagName.toLowerCase(),n.options.disableReturn||this.getAttribute("data-disable-return")||"li"===o||n.isListItemChild(i)||(e.shiftKey||t.execCommand("formatBlock",!1,"p"),"a"===o&&t.execCommand("unlink",!1,null)))}),this},isListItemChild:function(e){for(var t=e.parentNode,n=t.tagName.toLowerCase();-1===this.parentElements.indexOf(n)&&"div"!==n;){if("li"===n)return!0;if(t=t.parentNode,!t||!t.tagName)return!1;n=t.tagName.toLowerCase()}return!1},bindReturn:function(e){var t=this;return this.elements[e].addEventListener("keypress",function(e){if(13===e.which)if(t.options.disableReturn||this.getAttribute("data-disable-return"))e.preventDefault();else if(t.options.disableDoubleReturn||this.getAttribute("data-disable-double-return")){var n=r();n&&"\n"===n.innerText&&e.preventDefault()}}),this},bindTab:function(e){return this.elements[e].addEventListener("keydown",function(e){if(9===e.which){var n=r().tagName.toLowerCase();"pre"===n&&(e.preventDefault(),t.execCommand("insertHtml",null,"    "))}}),this},buttonTemplate:function(e){var t=this.getButtonLabels(this.options.buttonLabels),n={bold:'<button class="medium-editor-action medium-editor-action-bold" data-action="bold" data-element="b">'+t.bold+"</button>",italic:'<button class="medium-editor-action medium-editor-action-italic" data-action="italic" data-element="i">'+t.italic+"</button>",underline:'<button class="medium-editor-action medium-editor-action-underline" data-action="underline" data-element="u">'+t.underline+"</button>",strikethrough:'<button class="medium-editor-action medium-editor-action-strikethrough" data-action="strikethrough" data-element="strike"><strike>A</strike></button>',superscript:'<button class="medium-editor-action medium-editor-action-superscript" data-action="superscript" data-element="sup">'+t.superscript+"</button>",subscript:'<button class="medium-editor-action medium-editor-action-subscript" data-action="subscript" data-element="sub">'+t.subscript+"</button>",anchor:'<button class="medium-editor-action medium-editor-action-anchor" data-action="anchor" data-element="a">'+t.anchor+"</button>",image:'<button class="medium-editor-action medium-editor-action-image" data-action="image" data-element="img">'+t.image+"</button>",header1:'<button class="medium-editor-action medium-editor-action-header1" data-action="append-'+this.options.firstHeader+'" data-element="'+this.options.firstHeader+'">'+t.header1+"</button>",header2:'<button class="medium-editor-action medium-editor-action-header2" data-action="append-'+this.options.secondHeader+'" data-element="'+this.options.secondHeader+'">'+t.header2+"</button>",quote:'<button class="medium-editor-action medium-editor-action-quote" data-action="append-blockquote" data-element="blockquote">'+t.quote+"</button>",orderedlist:'<button class="medium-editor-action medium-editor-action-orderedlist" data-action="insertorderedlist" data-element="ol">'+t.orderedlist+"</button>",unorderedlist:'<button class="medium-editor-action medium-editor-action-unorderedlist" data-action="insertunorderedlist" data-element="ul">'+t.unorderedlist+"</button>",pre:'<button class="medium-editor-action medium-editor-action-pre" data-action="append-pre" data-element="pre">'+t.pre+"</button>",indent:'<button class="medium-editor-action medium-editor-action-indent" data-action="indent" data-element="ul">'+t.indent+"</button>",outdent:'<button class="medium-editor-action medium-editor-action-outdent" data-action="outdent" data-element="ul">'+t.outdent+"</button>"};return n[e]||!1},getButtonLabels:function(e){var t,n,o={bold:"<b>B</b>",italic:"<b><i>I</i></b>",underline:"<b><u>U</u></b>",superscript:"<b>x<sup>1</sup></b>",subscript:"<b>x<sub>1</sub></b>",anchor:"<b>#</b>",image:"<b>image</b>",header1:"<b>H1</b>",header2:"<b>H2</b>",quote:"<b>&ldquo;</b>",orderedlist:"<b>1.</b>",unorderedlist:"<b>&bull;</b>",pre:"<b>0101</b>",indent:"<b>&rarr;</b>",outdent:"<b>&larr;</b>"};if("fontawesome"===e?t={bold:'<i class="fa fa-bold"></i>',italic:'<i class="fa fa-italic"></i>',underline:'<i class="fa fa-underline"></i>',superscript:'<i class="fa fa-superscript"></i>',subscript:'<i class="fa fa-subscript"></i>',anchor:'<i class="fa fa-link"></i>',image:'<i class="fa fa-picture-o"></i>',quote:'<i class="fa fa-quote-right"></i>',orderedlist:'<i class="fa fa-list-ol"></i>',unorderedlist:'<i class="fa fa-list-ul"></i>',pre:'<i class="fa fa-code fa-lg"></i>',indent:'<i class="fa fa-indent"></i>',outdent:'<i class="fa fa-outdent"></i>'}:"object"==typeof e&&(t=e),"object"==typeof t)for(n in t)t.hasOwnProperty(n)&&(o[n]=t[n]);return o},initToolbar:function(){return this.toolbar?this:(this.toolbar=this.createToolbar(),this.keepToolbarAlive=!1,this.anchorForm=this.toolbar.querySelector(".medium-editor-toolbar-form-anchor"),this.anchorInput=this.anchorForm.querySelector("input"),this.toolbarActions=this.toolbar.querySelector(".medium-editor-toolbar-actions"),this.anchorPreview=this.createAnchorPreview(),this)},createToolbar:function(){var e=t.createElement("div");return e.id="medium-editor-toolbar-"+this.id,e.className="medium-editor-toolbar",e.appendChild(this.toolbarButtons()),e.appendChild(this.toolbarFormAnchor()),this.options.elementsContainer.appendChild(e),e},toolbarButtons:function(){var e,n,o,i,r=this.options.buttons,a=t.createElement("ul");for(a.id="medium-editor-toolbar-actions",a.className="medium-editor-toolbar-actions clearfix",n=0;n<r.length;n+=1)this.options.extensions.hasOwnProperty(r[n])?(i=this.options.extensions[r[n]],o=void 0!==i.getButton?i.getButton():null):o=this.buttonTemplate(r[n]),o&&(e=t.createElement("li"),s(o)?e.appendChild(o):e.innerHTML=o,a.appendChild(e));return a},toolbarFormAnchor:function(){var e=t.createElement("div"),n=t.createElement("input"),o=t.createElement("a");return o.setAttribute("href","#"),o.innerHTML="&times;",n.setAttribute("type","text"),n.setAttribute("placeholder",this.options.anchorInputPlaceholder),e.className="medium-editor-toolbar-form-anchor",e.id="medium-editor-toolbar-form-anchor",e.appendChild(n),e.appendChild(o),e},bindSelect:function(){var e,n=this,o="";for(this.checkSelectionWrapper=function(e){return e&&n.clickingIntoArchorForm(e)?!1:(clearTimeout(o),void(o=setTimeout(function(){n.checkSelection()},n.options.delay)))},t.documentElement.addEventListener("mouseup",this.checkSelectionWrapper),e=0;e<this.elements.length;e+=1)this.elements[e].addEventListener("keyup",this.checkSelectionWrapper),this.elements[e].addEventListener("blur",this.checkSelectionWrapper);return this},checkSelection:function(){var t,n;return this.keepToolbarAlive===!0||this.options.disableToolbar||(t=e.getSelection(),""===t.toString().trim()||this.options.allowMultiParagraphSelection===!1&&this.hasMultiParagraphs()?this.hideToolbarActions():(n=this.getSelectionElement(),!n||n.getAttribute("data-disable-toolbar")?this.hideToolbarActions():this.checkSelectionElement(t,n))),this},clickingIntoArchorForm:function(e){var t=this;return e.type&&"blur"===e.type.toLowerCase()&&e.relatedTarget&&e.relatedTarget===t.anchorInput?!0:!1},hasMultiParagraphs:function(){var e=a().replace(/<[\S]+><\/[\S]+>/gim,""),t=e.match(/<(p|h[0-6]|blockquote)>([\s\S]*?)<\/(p|h[0-6]|blockquote)>/g);return t?t.length:0},checkSelectionElement:function(e,t){var n;for(this.selection=e,this.selectionRange=this.selection.getRangeAt(0),n=0;n<this.elements.length;n+=1)if(this.elements[n]===t)return void this.setToolbarButtonStates().setToolbarPosition().showToolbarActions();this.hideToolbarActions()},getSelectionElement:function(){var t,n,o,i,r=e.getSelection(),a=function(e){var t=e;try{for(;!t.getAttribute("data-medium-element");)t=t.parentNode}catch(n){return!1}return t};try{t=r.getRangeAt(0),n=t.commonAncestorContainer,o=n.parentNode,i=n.getAttribute("data-medium-element")?n:a(o)}catch(s){i=a(o)}return i},setToolbarPosition:function(){var t=50,n=e.getSelection(),o=n.getRangeAt(0),i=o.getBoundingClientRect(),r=this.options.diffLeft-this.toolbar.offsetWidth/2,a=(i.left+i.right)/2,s=this.toolbar.offsetWidth/2;return i.top<t?(this.toolbar.classList.add("medium-toolbar-arrow-over"),this.toolbar.classList.remove("medium-toolbar-arrow-under"),this.toolbar.style.top=t+i.bottom-this.options.diffTop+e.pageYOffset-this.toolbar.offsetHeight+"px"):(this.toolbar.classList.add("medium-toolbar-arrow-under"),this.toolbar.classList.remove("medium-toolbar-arrow-over"),this.toolbar.style.top=i.top+this.options.diffTop+e.pageYOffset-this.toolbar.offsetHeight+"px"),this.toolbar.style.left=s>a?r+s+"px":e.innerWidth-a<s?e.innerWidth+r-s+"px":r+a+"px",this.hideAnchorPreview(),this},setToolbarButtonStates:function(){var e,t=this.toolbarActions.querySelectorAll("button");for(e=0;e<t.length;e+=1)t[e].classList.remove(this.options.activeButtonClass);return this.checkActiveButtons(),this},checkActiveButtons:function(){for(var e=Array.prototype.slice.call(this.elements),t=this.getSelectedParentElement();void 0!==t.tagName&&-1===this.parentElements.indexOf(t.tagName.toLowerCase)&&(this.activateButton(t.tagName.toLowerCase()),this.callExtensions("checkState",t),-1===e.indexOf(t));)t=t.parentNode},activateButton:function(e){var t=this.toolbar.querySelector('[data-element="'+e+'"]');null!==t&&-1===t.className.indexOf(this.options.activeButtonClass)&&(t.className+=" "+this.options.activeButtonClass)},bindButtons:function(){var e,t=this.toolbar.querySelectorAll("button"),n=this,o=function(e){e.preventDefault(),e.stopPropagation(),void 0===n.selection&&n.checkSelection(),this.className.indexOf(n.options.activeButtonClass)>-1?this.classList.remove(n.options.activeButtonClass):this.className+=" "+n.options.activeButtonClass,this.hasAttribute("data-action")&&n.execAction(this.getAttribute("data-action"),e)};for(e=0;e<t.length;e+=1)t[e].addEventListener("click",o);return this.setFirstAndLastItems(t),this},setFirstAndLastItems:function(e){return e.length>0&&(e[0].className+=" "+this.options.firstButtonClass,e[e.length-1].className+=" "+this.options.lastButtonClass),this},execAction:function(n,o){n.indexOf("append-")>-1?(this.execFormatBlock(n.replace("append-","")),this.setToolbarPosition(),this.setToolbarButtonStates()):"anchor"===n?this.triggerAnchorAction(o):"image"===n?t.execCommand("insertImage",!1,e.getSelection()):(t.execCommand(n,!1,null),this.setToolbarPosition())},rangeSelectsSingleNode:function(e){var t=e.startContainer;return t===e.endContainer&&t.hasChildNodes()&&e.endOffset===e.startOffset+1},getSelectedParentElement:function(){var e=null,t=this.selectionRange;return e=this.rangeSelectsSingleNode(t)?t.startContainer.childNodes[t.startOffset]:3===t.startContainer.nodeType?t.startContainer.parentNode:t.startContainer},triggerAnchorAction:function(){var e=this.getSelectedParentElement();return e.tagName&&"a"===e.tagName.toLowerCase()?t.execCommand("unlink",!1,null):"block"===this.anchorForm.style.display?this.showToolbarActions():this.showAnchorForm(),this},execFormatBlock:function(e){var n=this.getSelectionData(this.selection.anchorNode);if("blockquote"===e&&n.el&&"blockquote"===n.el.parentNode.tagName.toLowerCase())return t.execCommand("outdent",!1,null);if(n.tagName===e&&(e="p"),this.isIE){if("blockquote"===e)return t.execCommand("indent",!1,e);e="<"+e+">"}return t.execCommand("formatBlock",!1,e)},getSelectionData:function(e){var t;for(e&&e.tagName&&(t=e.tagName.toLowerCase());e&&-1===this.parentElements.indexOf(t);)e=e.parentNode,e&&e.tagName&&(t=e.tagName.toLowerCase());return{el:e,tagName:t}},getFirstChild:function(e){for(var t=e.firstChild;null!==t&&1!==t.nodeType;)t=t.nextSibling;return t},hideToolbarActions:function(){this.keepToolbarAlive=!1,void 0!==this.toolbar&&this.toolbar.classList.remove("medium-editor-toolbar-active")},showToolbarActions:function(){var e,t=this;this.anchorForm.style.display="none",this.toolbarActions.style.display="block",this.keepToolbarAlive=!1,clearTimeout(e),e=setTimeout(function(){t.toolbar&&!t.toolbar.classList.contains("medium-editor-toolbar-active")&&t.toolbar.classList.add("medium-editor-toolbar-active")},100)},saveSelection:function(){this.savedSelection=o()},restoreSelection:function(){i(this.savedSelection)},showAnchorForm:function(e){this.toolbarActions.style.display="none",this.saveSelection(),this.anchorForm.style.display="block",this.keepToolbarAlive=!0,this.anchorInput.focus(),this.anchorInput.value=e||""},bindAnchorForm:function(){var e=this.anchorForm.querySelector("a"),t=this;return this.anchorForm.addEventListener("click",function(e){e.stopPropagation()}),this.anchorInput.addEventListener("keyup",function(e){13===e.keyCode&&(e.preventDefault(),t.createLink(this))}),this.anchorInput.addEventListener("click",function(e){e.stopPropagation(),t.keepToolbarAlive=!0}),this.anchorInput.addEventListener("blur",function(){t.keepToolbarAlive=!1,t.checkSelection()}),e.addEventListener("click",function(e){e.preventDefault(),t.showToolbarActions(),i(t.savedSelection)}),this},hideAnchorPreview:function(){this.anchorPreview.classList.remove("medium-editor-anchor-preview-active")},showAnchorPreview:function(t){if(this.anchorPreview.classList.contains("medium-editor-anchor-preview-active"))return!0;var n,o,i,r=this,a=40,s=t.getBoundingClientRect(),l=(s.left+s.right)/2;return r.anchorPreview.querySelector("i").textContent=t.href,n=r.anchorPreview.offsetWidth/2,o=r.options.diffLeft-n,clearTimeout(i),i=setTimeout(function(){r.anchorPreview&&!r.anchorPreview.classList.contains("medium-editor-anchor-preview-active")&&r.anchorPreview.classList.add("medium-editor-anchor-preview-active")},100),r.observeAnchorPreview(t),r.anchorPreview.classList.add("medium-toolbar-arrow-over"),r.anchorPreview.classList.remove("medium-toolbar-arrow-under"),r.anchorPreview.style.top=Math.round(a+s.bottom-r.options.diffTop+e.pageYOffset-r.anchorPreview.offsetHeight)+"px",r.anchorPreview.style.left=n>l?o+n+"px":e.innerWidth-l<n?e.innerWidth+o-n+"px":o+l+"px",this},observeAnchorPreview:function(e){var t=this,n=(new Date).getTime(),o=!0,i=function(){n=(new Date).getTime(),o=!0},r=function(e){e.relatedTarget&&/anchor-preview/.test(e.relatedTarget.className)||(o=!1)},a=setInterval(function(){if(o)return!0;var s=(new Date).getTime()-n;s>t.options.anchorPreviewHideDelay&&(t.hideAnchorPreview(),clearInterval(a),t.anchorPreview.removeEventListener("mouseover",i),t.anchorPreview.removeEventListener("mouseout",r),e.removeEventListener("mouseover",i),e.removeEventListener("mouseout",r))},200);t.anchorPreview.addEventListener("mouseover",i),t.anchorPreview.addEventListener("mouseout",r),e.addEventListener("mouseover",i),e.addEventListener("mouseout",r)},createAnchorPreview:function(){var e=this,n=t.createElement("div");return n.id="medium-editor-anchor-preview-"+this.id,n.className="medium-editor-anchor-preview",n.innerHTML=this.anchorPreviewTemplate(),this.options.elementsContainer.appendChild(n),n.addEventListener("click",function(){e.anchorPreviewClickHandler()}),n},anchorPreviewTemplate:function(){return'<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <i class="medium-editor-toolbar-anchor-preview-inner"></i></div>'},anchorPreviewClickHandler:function(){if(this.activeAnchor){var n=this,o=t.createRange(),i=e.getSelection();o.selectNodeContents(n.activeAnchor),i.removeAllRanges(),i.addRange(o),setTimeout(function(){n.activeAnchor&&n.showAnchorForm(n.activeAnchor.href),n.keepToolbarAlive=!1},100+n.options.delay)}this.hideAnchorPreview()},editorAnchorObserver:function(e){var t=this,n=!0,o=function(){n=!1,t.activeAnchor.removeEventListener("mouseout",o)};if(e.target&&"a"===e.target.tagName.toLowerCase()){if(!/href=["']\S+["']/.test(e.target.outerHTML)||/href=["']#\S+["']/.test(e.target.outerHTML))return!0;if(this.toolbar.classList.contains("medium-editor-toolbar-active"))return!0;this.activeAnchor=e.target,this.activeAnchor.addEventListener("mouseout",o),setTimeout(function(){n&&t.showAnchorPreview(e.target)},t.options.delay)}},bindAnchorPreview:function(){var e,t=this;for(this.editorAnchorObserverWrapper=function(e){t.editorAnchorObserver(e)},e=0;e<this.elements.length;e+=1)this.elements[e].addEventListener("mouseover",this.editorAnchorObserverWrapper);return this},checkLinkFormat:function(e){var t=/^(https?|ftps?|rtmpt?):\/\/|mailto:/;return(t.test(e)?"":"http://")+e},setTargetBlank:function(){var e,t=r();if("a"===t.tagName.toLowerCase())t.target="_blank";else for(t=t.getElementsByTagName("a"),e=0;e<t.length;e+=1)t[e].target="_blank"},createLink:function(e){return 0===e.value.trim().length?void this.hideToolbarActions():(i(this.savedSelection),this.options.checkLinkFormat&&(e.value=this.checkLinkFormat(e.value)),t.execCommand("createLink",!1,e.value),this.options.targetBlank&&this.setTargetBlank(),this.checkSelection(),this.showToolbarActions(),void(e.value=""))},bindWindowActions:function(){var t,n=this;return this.windowResizeHandler=function(){clearTimeout(t),t=setTimeout(function(){n.toolbar&&n.toolbar.classList.contains("medium-editor-toolbar-active")&&n.setToolbarPosition()},100)},e.addEventListener("resize",this.windowResizeHandler),this},activate:function(){this.isActive||this.setup()},deactivate:function(){var n;if(this.isActive)for(this.isActive=!1,void 0!==this.toolbar&&(this.options.elementsContainer.removeChild(this.anchorPreview),this.options.elementsContainer.removeChild(this.toolbar),delete this.toolbar,delete this.anchorPreview),t.documentElement.removeEventListener("mouseup",this.checkSelectionWrapper),e.removeEventListener("resize",this.windowResizeHandler),n=0;n<this.elements.length;n+=1)this.elements[n].removeEventListener("mouseover",this.editorAnchorObserverWrapper),this.elements[n].removeEventListener("keyup",this.checkSelectionWrapper),this.elements[n].removeEventListener("blur",this.checkSelectionWrapper),this.elements[n].removeEventListener("paste",this.pasteWrapper),this.elements[n].removeAttribute("contentEditable"),this.elements[n].removeAttribute("data-medium-element")},htmlEntities:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},bindPaste:function(){var e,n=this;for(this.pasteWrapper=function(e){var o,i,r="";if(this.classList.remove("medium-editor-placeholder"),!n.options.forcePlainText&&!n.options.cleanPastedHTML)return this;if(e.clipboardData&&e.clipboardData.getData&&!e.defaultPrevented){if(e.preventDefault(),n.options.cleanPastedHTML&&e.clipboardData.getData("text/html"))return n.cleanPaste(e.clipboardData.getData("text/html"));if(n.options.disableReturn||this.getAttribute("data-disable-return"))t.execCommand("insertHTML",!1,e.clipboardData.getData("text/plain"));else{for(o=e.clipboardData.getData("text/plain").split(/[\r\n]/g),i=0;i<o.length;i+=1)""!==o[i]&&(r+=navigator.userAgent.match(/firefox/i)&&0===i?n.htmlEntities(o[i]):"<p>"+n.htmlEntities(o[i])+"</p>");t.execCommand("insertHTML",!1,r)}}},e=0;e<this.elements.length;e+=1)this.elements[e].addEventListener("paste",this.pasteWrapper);return this},setPlaceholders:function(){var e,t=function(e){e.querySelector("img")||e.querySelector("blockquote")||""!==e.textContent.replace(/^\s+|\s+$/g,"")||e.classList.add("medium-editor-placeholder")},n=function(e){this.classList.remove("medium-editor-placeholder"),"keypress"!==e.type&&t(this)};for(e=0;e<this.elements.length;e+=1)t(this.elements[e]),this.elements[e].addEventListener("blur",n),this.elements[e].addEventListener("keypress",n);return this},cleanPaste:function(e){var n,o,i,r=this.getSelectionElement(),a=/<p|<br|<div/.test(e),s=[[new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi),""],[new RegExp(/<\/b>(<br[^>]*>)?$/gi),""],[new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g)," "],[new RegExp(/<br class="Apple-interchange-newline">/g),"<br>"],[new RegExp(/<span[^>]*(font-style:italic;font-weight:bold|font-weight:bold;font-style:italic)[^>]*>/gi),'<span class="replace-with italic bold">'],[new RegExp(/<span[^>]*font-style:italic[^>]*>/gi),'<span class="replace-with italic">'],[new RegExp(/<span[^>]*font-weight:bold[^>]*>/gi),'<span class="replace-with bold">'],[new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi),"<$1$2>"],[new RegExp(/&lt;a\s+href=(&quot;|&rdquo;|&ldquo;|“|”)([^&]+)(&quot;|&rdquo;|&ldquo;|“|”)&gt;/gi),'<a href="$2">']];for(n=0;n<s.length;n+=1)e=e.replace(s[n][0],s[n][1]);if(a)for(o=e.split("<br><br>"),this.pasteHTML("<p>"+o.join("</p><p>")+"</p>"),t.execCommand("insertText",!1,"\n"),o=r.querySelectorAll("p,div,br"),n=0;n<o.length;n+=1)switch(i=o[n],i.tagName.toLowerCase()){case"p":case"div":this.filterCommonBlocks(i);break;case"br":this.filterLineBreak(i)}else this.pasteHTML(e)},pasteHTML:function(e){var n,o,i,r,a=t.createDocumentFragment();for(a.appendChild(t.createElement("body")),r=a.querySelector("body"),r.innerHTML=e,this.cleanupSpans(r),n=r.querySelectorAll("*"),i=0;i<n.length;i+=1)o=n[i],o.removeAttribute("class"),o.removeAttribute("style"),o.removeAttribute("dir"),"meta"===o.tagName.toLowerCase()&&o.parentNode.removeChild(o);t.execCommand("insertHTML",!1,r.innerHTML.replace(/&nbsp;/g," "))},isCommonBlock:function(e){return e&&("p"===e.tagName.toLowerCase()||"div"===e.tagName.toLowerCase())},filterCommonBlocks:function(e){/^\s*$/.test(e.innerText)&&e.parentNode.removeChild(e)},filterLineBreak:function(e){this.isCommonBlock(e.previousElementSibling)?e.parentNode.removeChild(e):!this.isCommonBlock(e.parentNode)||e.parentNode.firstChild!==e&&e.parentNode.lastChild!==e?1===e.parentNode.childElementCount&&this.removeWithParent(e):e.parentNode.removeChild(e)},removeWithParent:function(e){e&&e.parentNode&&(e.parentNode.parentNode&&1===e.parentNode.childElementCount?e.parentNode.parentNode.removeChild(e.parentNode):e.parentNode.removeChild(e.parentNode))},cleanupSpans:function(e){var n,o,i,r=e.querySelectorAll(".replace-with");for(n=0;n<r.length;n+=1)o=r[n],i=t.createElement(o.classList.contains("bold")?"b":"i"),i.innerHTML=o.classList.contains("bold")&&o.classList.contains("italic")?"<i>"+o.innerHTML+"</i>":o.innerHTML,o.parentNode.replaceChild(i,o);for(r=e.querySelectorAll("span"),n=0;n<r.length;n+=1)o=r[n],/^\s*$/.test()?o.parentNode.removeChild(o):o.parentNode.replaceChild(t.createTextNode(o.innerText),o)}}}(window,document);var OrderedListComponent;OrderedListComponent=function(){function e(){}return e.prototype.name="Ordered List",e.prototype.id="ordered-list",e.prototype.type="group",e.prototype.template='<ol class="ordered-list"> <li ng-repeat="b in block.blocks"> <faber-render data-faber-render-block="b"/> </li> </ol>',e.prototype.init=function(){},e}(),"document"in self&&!("classList"in document.createElement("_"))&&!function(e){"use strict";if("Element"in e){var t="classList",n="prototype",o=e.Element[n],i=Object,r=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},a=Array[n].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},s=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},l=function(e,t){if(""===t)throw new s("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new s("INVALID_CHARACTER_ERR","String contains an invalid character");return a.call(e,t)},c=function(e){for(var t=r.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],o=0,i=n.length;i>o;o++)this.push(n[o]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},u=c[n]=[],d=function(){return new c(this)};if(s[n]=Error[n],u.item=function(e){return this[e]||null},u.contains=function(e){return e+="",-1!==l(this,e)},u.add=function(){var e,t=arguments,n=0,o=t.length,i=!1;do e=t[n]+"",-1===l(this,e)&&(this.push(e),i=!0);while(++n<o);i&&this._updateClassName()},u.remove=function(){var e,t=arguments,n=0,o=t.length,i=!1;do{e=t[n]+"";var r=l(this,e);-1!==r&&(this.splice(r,1),i=!0)}while(++n<o);i&&this._updateClassName()},u.toggle=function(e,t){e+="";var n=this.contains(e),o=n?t!==!0&&"remove":t!==!1&&"add";return o&&this[o](e),!n},u.toString=function(){return this.join(" ")},i.defineProperty){var p={get:d,enumerable:!0,configurable:!0};try{i.defineProperty(o,t,p)}catch(m){-2146823252===m.number&&(p.enumerable=!1,i.defineProperty(o,t,p))}}else i[n].__defineGetter__&&o.__defineGetter__(t,d)}}(self);var MediumEditorExtended,RichTextComponent,__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var o in t)__hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};MediumEditorExtended=function(e){function t(e,t){this.defaults.firstHeader="h1",this.defaults.secondHeader="h2",this.init(e,t)}return __extends(t,e),t.prototype.init=function(e,n){return t.__super__.init.call(this,e,n)},t.prototype.buttonTemplate=function(e){var n;return n={header3:'<li><button class="medium-editor-action medium-editor-action-header3" data-action="append-h3" data-element="h3">H3</button></li>'},t.__super__.buttonTemplate.call(this,e)||n[e]},t}(MediumEditor),RichTextComponent=function(){function e(){}return e.prototype.name="Rich Text",e.prototype.id="rich-text",e.prototype.type="element",e.prototype.template='<div class="rich-text-wrapper"><div class="ie-exec-command-stopper"></div><div class="rich-text-editor"><br/></div><div class="ie-exec-command-stopper"></div></div>',e.prototype.editor=null,e.prototype.editorInstance=null,e.prototype.init=function(e,t,n,o){var i,r,a,s,l,c;for(r={buttons:["bold","italic","underline","anchor","unorderedlist","orderedlist","header1","header2","header3","quote"],placeholder:"Type your text"},this.editor=t[0].getElementsByClassName("rich-text-editor")[0],this.editor.innerHTML=n.html||"",o({html:this.editor.innerHTML}),this.editorInstance=new MediumEditorExtended(this.editor,r),l=["keyup","input","blur","paste"],c=[],a=0,s=l.length;s>a;a++)i=l[a],c.push(this.editor.addEventListener(i,function(e){return function(){return o({html:e.editor.innerHTML})}}(this)));return c},e.prototype.selected=function(e,t){return t[0].getElementsByClassName("rich-text-editor")[0].focus()},e.prototype.unselected=function(e,t,n){return n({html:this.editor.innerHTML})},e}();var FaberComponent;FaberComponent=function(){function e(e){null==e&&(e=[]),this.id=e.id||"",this.name=e.name||"",this.type=e.type||"group",this.template=e.template||"",this.topLevelOnly="group"===e.type&&(e.topLevelOnly===!0||void 0===e.topLevelOnly)}return e.prototype.id="",e.prototype.name="",e.prototype.type="group",e.prototype.template="",e.prototype.topLevelOnly=!1,e.prototype.init=function(){},e.prototype.selected=function(){},e.prototype.unselected=function(){},e}(),window.faber=angular.extend(angular.module("faber",["ngAnimate"]).value("faberConfig",{}).run(["configService","contentService",function(e,t){return faber["import"]=t["import"],faber["export"]=t["export"],faber.init=e.init,faber.init(faber.initialConfig)}]),{init:function(e){return this.initialConfig=e},listen:function(e,t,n,o){var i,r;return(r=this.listeners)||(r=this.listeners={}),(i=r[e])||(i=r[e]=[]),n=null!=n?n:{scope:window},i.push({method:t,scope:n,context:null!=o?o:{context:n}})},stopListening:function(e,t){var n,o;if((o=this.listeners)&&(n=o[e]))return n.splice(n.indexOf(t),1)},fire:function(e,t,n){var o,i,r,a,s;if((r=this.listeners)&&(i=r[e])){for(a=0,s=i.length;s>a;a++)if(o=i[a],(typeof n!==!1||n!==!o.context)&&o.method.call(e,t)===!1)return!1;return!0}}}),angular.module("faber").animation(".faber-block-repeat",["$window","$document","$rootElement","$interval",function(e,t,n,o){var i;return i=function(e){var t;if(t=0,e.offsetParent)for(;;)if(t+=e.offsetTop,e=e.offsetParent,!e)break;return Math.max(t,0)},{move:function(t){var n,r,a;return a=e.pageYOffset,r=i(t[0])-40,n=r-a,o.cancel(e.faberBlockRepeatAnimationWatch),e.faberBlockRepeatAnimationWatch=o(function(){return n/=2,e.scrollBy(0,n),Math.abs(n)<=1?o.cancel(e.faberBlockRepeatAnimationWatch):void 0},50),null}}}]),angular.module("faber").controller("BlockController",["$rootScope","$scope","$log","componentsService","contentService",function(e,t,n,o){return t.block||(t.block={}),t.components=o.getAll(),t.component=null,t.validateBlock=function(e){var n,i,r;
return r=!0,angular.isString(e.component)?n=o.findById(e.component):angular.isObject(e.component)&&angular.isString(e.component.id)&&(n=o.findById(e.component.id)),n?(i=t.isTopLevel,r&=!n.topLevelOnly||n.topLevelOnly&&i,r&=!e.inputs||angular.isObject(e.inputs)):!1},t.add=function(e){var o;return t.validateBlock(e)?((o=t.block).blocks||(o.blocks=[]),t.block.blocks.push(e),!0):(n.warn({"cannot find a component of the given name":e.component}),!1)},t.remove=function(n){return confirm("Are you sure you want to permanently remove this block?\n\nYou can't undo this action.")?(t.block.blocks.splice(t.block.blocks.indexOf(n),1),e.$broadcast("BlockUpdated")):void 0},t.insert=function(e,n){return t.validateBlock(n)?t.block.blocks.splice(e,0,n):void 0},t.insertGroup=function(e){return t.block.blocks.splice(e,0,{component:o.findByType("group")[0].id})},t.move=function(n,o){var i;return i=t.block.blocks.length,n>=0&&i>n&&o>=0&&i>o?(t.block.blocks.splice(o,0,t.block.blocks.splice(n,1)[0]),t.$broadcast("BlockMoved"),e.$broadcast("BlockUpdated")):void 0},t.$watch("block.component",function(i){var r;return i?(r=o.findById(i),!r&&o.getAll().length>0?n.warn({"cannot find a component of the given name":i}):(t.component=r||new FaberComponent,e.$broadcast("BlockUpdated"))):void 0}),t.$watch("block.content",function(){return e.$broadcast("BlockUpdated")},!0),t.$watch("block.blocks",function(){return e.$broadcast("BlockUpdated")})}]),angular.module("faber").controller("EditorController",["$rootScope","$scope","$controller","$log","configService","contentService","componentsService",function(e,t,n,o,i,r,a){var s,l,c,u;return s=function(n){return e.isExpanded=angular.isDefined(n.expanded)?n.expanded:!0,a.init(n.components||[]),t.components=a.getAll()},n("BlockController",{$scope:t}),t.isTopLevel=!0,t.block.blocks=[],r.init(t.block),s(i.get()),l=function(e){var n;return t.validateBlock(e&&(null!=(n=e.blocks)?n.length:void 0)>0)&&(e.blocks=u(e.blocks)),e},c=function(e){var t,n,o,i,r,a;if((null!=(i=e.blocks)?i.length:void 0)>0)for(r=e.blocks,n=0,o=r.length;o>n;n++)t=r[n],(null!=(a=t.blocks)?a.length:void 0)>0&&(t.blocks=u(t.blocks));return e},u=function(e){var t,n,i,r,s;for(i=[],r=0,s=e.length;s>r;r++)t=e[r],n=a.findById(t.component),n?("element"===n.type&&i.push(l(t)),"group"===n.type&&i.push(c(t))):o.warn({"cannot find a component with the given id":t.component});return i},t.$on("imported",function(e,n){return t.$apply(function(){return t.block.blocks=u(n)})}),t.$on("ConfigUpdated",function(e,t){return s(t)}),e.$on("BlockUpdated",function(){return angular.module("faber").fire("BlockUpdated",angular.copy(t.block.blocks))})}]),angular.module("faber").controller("ElementBlockController",["$controller","$scope",function(e,t){var n;return e("BlockController",{$scope:t}),(n=t.block).content||(n.content="")}]),angular.module("faber").controller("GroupBlockController",["$rootScope","$controller","$scope","componentsService",function(e,t,n,o){var i;return t("BlockController",{$scope:n}),(i=n.block).blocks||(i.blocks=[]),n.components=[{name:"Item",id:"group-item",template:""}],n.groupComponents=o.findByType("group"),n.insertGroupItem=function(e){var t;return t={blocks:[]},n.block.blocks.splice(e,0,t)}}]),angular.module("faber").controller("GroupItemBlockController",["$rootScope","$controller","$scope","componentsService",function(e,t,n,o){var i;return t("BlockController",{$scope:n}),(i=n.block).blocks||(i.blocks=[]),n.components=o.findByType("element"),n.$watch("block.title",function(){return e.$broadcast("BlockUpdated")})}]),angular.module("faber").directive("faberBlock",["$rootScope","$compile","$timeout",function(e,t,n){var o;return o=function(e){return e&&e.target&&"select"===e.target.tagName.toLowerCase()},{scope:{block:"=faberBlockContent"},restrict:"E",templateUrl:"faber-block.html",controller:"BlockController",compile:function(i,r,a){var s,l;return l=i.contents().remove(),s=null,{pre:function(e,n){return s||(s=t(l,a)),s(e,function(e){return n.append(e)})},post:function(t,i){return t.currentIndex=t.$parent.$index,t.isExpanded=!!e.isExpanded,t.isSelected=!1,t.isMoving=!1,t.isPreview=!1,t.isGroupBlock=!1,t.isGroupItemBlock=!1,t.isElementBlock=!1,t.isMouseHover=!1,t.mouseOver=function(){return t.isMouseHover=!0},t.mouseOut=function(e){return o(e)?void 0:t.isMouseHover=!1},t.indexRange=function(){var e,n,o,i,r;for(i=[],o=0,n=t.$parent&&t.$parent.block&&t.$parent.block.blocks?Math.max(t.$parent.block.blocks.length-1,o):o,e=r=o;n>=o?n>=r:r>=n;e=n>=o?++r:--r)i.push(e);return i},t.onSelectChange=function(){var o;return o=i.find("select").val(),o>=0?(t.moveSelf(o),e.$broadcast("ResetIsMoving"),n(function(){return t.isMoving=!0})):void 0},t.onBlockClick=function(n){return n&&n.stopPropagation(),o(n)?void 0:(e.$broadcast("ShowComponents",null),e.$broadcast("SelectBlockOfIndex",t.$parent,t.$parent.block.blocks.indexOf(t.block)))},t.select=function(){return t.isSelected=!0},t.unselect=function(){return t.isSelected=!1},t.removeSelf=function(){return t.$parent.remove(t.block)},t.moveSelf=function(e){return t.$parent.move(t.$parent.block.blocks.indexOf(t.block),e)},t.edit=function(n){return n&&n.stopPropagation(),t.isGroupBlock?(t.isPreview=!1,e.$broadcast("ResetIsMoving"),t.$broadcast("BlockModeChanged",t.isPreview)):void 0},t.preview=function(e){return e&&e.stopPropagation(),t.isGroupBlock?(t.isPreview=!0,t.$broadcast("BlockModeChanged",t.isPreview)):void 0},t.expand=function(e){return e&&e.stopPropagation(),t.isGroupItemBlock?t.isExpanded=!0:void 0},t.collapse=function(e){return e&&e.stopPropagation(),t.isGroupItemBlock?t.isExpanded=!1:void 0},t.$on("ResetIsMoving",function(){return t.isMoving=!1}),t.$on("SelectBlockOfIndex",function(e,n,o){return n?n.block.blocks[o]===t.block?t.select():t.unselect():void t.unselect()}),t.$on("PreviewAll",function(){return t.preview()}),t.$on("CollapseAll",function(){return t.isExpanded=!1}),t.$on("ExpandAll",function(){return t.isExpanded=!0}),t.$watchCollection("[$parent.component, component]",function(){return t.isElementBlock=t.isGroupBlock=t.isGroupItemBlock=!1,t.$parent.component&&"group"===t.$parent.component.type?t.isGroupItemBlock=!0:t.component&&("element"===t.component.type&&(t.isElementBlock=!0),"group"===t.component.type)?t.isGroupBlock=!0:void 0})}}}}}]),angular.module("faber").directive("faberComponentRenderer",["$rootScope","$compile","componentsService",function(e,t,n){return{restrict:"AE",template:'<div ng-class="component.id"></div>',scope:{block:"=faberComponentRendererBlock",checkGroupPreview:"&faberGroupPreview"},link:function(o,i){var r;return o.isGroupPreview=o.checkGroupPreview()||!1,o.isSelected=!1,r=function(e){var n,r,a;return r=o.component.template,n=t(r)(o),a=i.find("div"),a.empty(),i.find("div").append(n),o.component.init&&("element"===o.component.type&&o.component.init(o,i,e,o.updateRendered),"group"===o.component.type)?o.component.init(o,i,e):void 0},o.component=null,o.selectRendered=function(){return o.isSelected=!0,o.component.selected?o.component.selected(o,i,o.updateRendered):void 0},o.unselectRendered=function(){return o.isSelected=!1,o.component.unselected?o.component.unselected(o,i,o.updateRendered):void 0},o.updateRendered=function(t){return t?(o.block.content=t,e.$broadcast("BlockUpdated")):void 0},o.$watch("block.component",function(){var e;if(o.block)return o.component=n.findById(o.block.component),o.block.component&&o.component?(e="element"===o.component.type?o.block.content:angular.copy(o.block.blocks),r(e)):void 0}),o.$on("BlockModeChanged",function(){return r(o.block.content)}),o.$on("SelectBlockOfIndex",function(e,t,n){return t?t.block.blocks[n]===o.block?o.selectRendered():o.isSelected?o.unselectRendered():void 0:void(o.isSelected&&o.unselectRendered())})}}}]),angular.module("faber").directive("faberComponents",["$rootScope","$filter","$timeout",function(e,t,n){var o;return o=function(t,n){return t&&t.stopPropagation(),e.$broadcast("SelectBlockOfIndex",null),n.showingComponents=!1,n.$index+1||0},{restrict:"AE",templateUrl:"faber-components.html",link:function(i){return i.showingComponents=0===i.block.blocks.length,i.hasGroupComponents=function(){var e;return e=t("filter")(i.components,{type:"group"},!0),e.length>0},i.$watch("showingComponents",function(t){return t?e.$broadcast("ShowComponents",i.$id):void 0}),i.$watch("isExpanded",function(e){if(i.isGroupItemBlock){if(!e)return i.showingComponents=!1;if(0===i.block.blocks.length)return i.showingComponents=!0}}),i.$watchCollection("block.blocks",function(e){return 0===e.length?i.showingComponents=!0:void 0}),i.$on("ShowComponents",function(e,t){return i.showingComponents=0===i.block.blocks.length||t===i.$id}),i.insertBlock=function(t,o){var r;return t&&t.stopPropagation(),i.showingComponents=!1,r=i.isExpanded?i.$index+1||0:i.block.blocks.length,i.isGroupItemBlock&&i.expand(),i.insert(r,o),n(function(){return e.$broadcast("SelectBlockOfIndex",i,r)})},i.insertGroupBlock=function(e){return i.insertGroup(o(e,i))},i.insertGroupItemBlock=function(e){return i.insertGroupItem(o(e,i))},i.toggleComponents=function(e){return e&&e.stopPropagation(),i.showingComponents=!i.showingComponents}}}}]),angular.module("faber").directive("faberEditor",["$rootScope","$document","$timeout",function(e,t,n){return{restrict:"AE",templateUrl:"faber-editor.html",controller:"EditorController",link:function(o,i){return t[0].addEventListener("click",function(t){var n,r;for(r=!1,n=t.target;n&&n.tagName&&"body"!==n.tagName.toLowerCase();){if(n===i[0]){r=!0;break}n=n.parentNode}return r?void 0:e.$apply(function(){return 0!==o.block.blocks.length&&e.$broadcast("ShowComponents",null),e.$broadcast("SelectBlockOfIndex",null)})},!0),o.$on("imported",function(t,o){return i.css("display","none"),n(function(){return 0!==o.length&&e.$broadcast("ShowComponents",null),e.$broadcast("PreviewAll"),e.$broadcast("CollapseAll"),i.css("display","block")})}),e.$watch("isExpanded",function(){return e.$broadcast(e.isExpanded?"ExpandAll":"CollapseAll")})}}}]),angular.module("faber").directive("faberElementBlock",["$rootScope","$compile","$timeout",function(){return{restrict:"E",templateUrl:"faber-element-block.html",controller:"ElementBlockController"}}]),angular.module("faber").directive("faberGroupBlock",function(){return{restrict:"E",templateUrl:"faber-group-block.html",controller:"GroupBlockController",link:function(e){return e.$watch("component",function(t){return t?e.currentComponent=t.id:void 0}),e.$watch("currentComponent",function(t){var n;return t!==(null!=(n=e.component)?n.id:void 0)?(e.block.component=t,e.isSelected=!0):void 0})}}}),angular.module("faber").directive("faberGroupItemBlock",function(){return{restrict:"E",templateUrl:"faber-group-item-block.html",controller:"GroupItemBlockController",link:function(e,t){return t[0].querySelector(".faber-group-item-title input").focus()}}}),angular.module("faber").directive("faberRender",["$compile","componentsService",function(){return{restrict:"AE",templateUrl:"faber-render.html",scope:{data:"=faberRenderBlock"},link:function(e){return e.isGroupPreview=function(){return!0}}}}]),angular.module("faber").directive("trustHtml",["$sce",function(e){return{replace:!0,restrict:"M",template:'<div ng-bind-html="trustedHtml"></div>',link:function(t,n,o){return t.$watch(o.trustHtml,function(n,o){return null!=n!==o?t.trustedHtml=e.trustAsHtml(n):void 0})}}}]),angular.module("faber").run(["$templateCache",function(e){e.put("faber-block.html",'<div ng-class="{\'faber-element-block\': isElementBlock, \'faber-group-block\': isGroupBlock, \'faber-group-item-block\': isGroupItemBlock, \'faber-block-preview\': isPreview,\'faber-block-hover\': isMouseHover, \'faber-block-selected\': isSelected, \'faber-block-moving\': isMoving}" ng-mouseover="mouseOver($event)" ng-mouseout="mouseOut($event)" ng-click="onBlockClick($event)" class="faber-block-item"><div class="faber-block-actions"><div ng-if="isGroupBlock" class="faber-group-block-actions"><button title="Edit" ng-if="isPreview" ng-click="edit($event)" class="faber-edit-group-button faber-icon-edit toggled-on"></button><button title="Preview" ng-if="!isPreview" ng-click="preview($event)" class="faber-preview-group-button faber-icon-edit"></button></div><div ng-if="isGroupItemBlock" class="faber-group-item-block-actions"><button title="Expand" ng-if="!isExpanded" ng-click="expand($event)" class="faber-icon-plus"></button><button title="Collapse" ng-if="isExpanded" ng-click="collapse($event)" class="faber-icon-minus"></button></div><label class="faber-select faber-block-position"><select ng-model="$parent.$index" ng-options="i as (i == $parent.$index ? (i+1)+\' (current)\' : i+1) for i in indexRange()" ng-change="onSelectChange()"></select><button title="Change order" class="faber-icon-sort"></button></label><button title="Remove" ng-click="removeSelf()" class="faber-icon-remove"></button></div><faber-group-item-block ng-if="isGroupItemBlock"></faber-group-item-block><faber-element-block ng-if="isElementBlock"></faber-element-block><faber-group-block ng-if="isGroupBlock" ng-class="{\'faber-group-block-preview\': isPreview}"></faber-group-block></div>'),e.put("faber-components.html",'<div ng-click="toggleComponents($event)"><div ng-if="!showingComponents" class="faber-components-line"></div><i ng-if="!showingComponents" class="faber-icon-plus"></i><ul ng-if="showingComponents" class="faber-available-components"><li ng-repeat="comp in components | filter : {type: \'element\'}" class="faber-component"><button ng-click="insertBlock($event, {component: comp.id })">{{comp.name}}</button></li><li ng-if="hasGroupComponents()" class="faber-component"><button ng-click="insertGroupBlock($event)" class="faber-group-button"><span class="faber-icon-group"></span>Group</button></li><li ng-if="component.type == \'group\'" class="faber-component"><button ng-click="insertGroupItemBlock($event)" class="faber-group-button">Item</button></li></ul></div>'),e.put("faber-editor.html",'<faber-components></faber-components><div class="faber-blocks"><div ng-repeat="data in block.blocks" class="faber-block-repeat"><faber-block data-faber-block-content="data"></faber-block><faber-components></faber-components></div></div>'),e.put("faber-element-block.html",'<faber-component-renderer data-faber-component-renderer-block="block"></faber-component-renderer>'),e.put("faber-group-block.html",'<label ng-hide="isPreview" class="faber-select faber-group-component"><span>{{component.name}}<select ng-model="currentComponent" ng-options="c.id as c.name for c in groupComponents"></select><i class="faber-icon-button faber-icon-arrow-down"></i></span></label><faber-component-renderer data-faber-component-renderer-block="block" ng-if="isPreview"></faber-component-renderer><faber-components ng-show="!isPreview"></faber-components><div ng-hide="isPreview" class="faber-blocks"><div ng-repeat="data in block.blocks" class="faber-block-repeat"><faber-block data-faber-block-content="data"></faber-block><faber-components></faber-components></div></div>'),e.put("faber-group-item-block.html",'<label class="faber-group-item-title"><input type="text" placeholder="Type the item\'s title" ng-model="block.title"/></label><faber-components ng-if="isExpanded"></faber-components><div ng-if="isExpanded" class="faber-blocks"><div ng-repeat="data in block.blocks" class="faber-block-repeat"><faber-block data-faber-block-content="data"></faber-block><faber-components></faber-components></div></div>'),e.put("faber-render.html",'<div ng-repeat="block in data.blocks" ng-if="data"><faber-component-renderer data-faber-component-renderer-block="block" data-faber-group-preview="isGroupPreview()"></faber-component-renderer></div>')}]),angular.module("faber").factory("componentsService",["$filter","$log",function(e,t){var n,o;return n=[],o=function(e){var t;return t=new e,angular.isString(t.id)&&("element"===t.type||"group"===t.type)},{init:function(e){var i,r,a,s;for(n=[],s=[],r=0,a=e.length;a>r;r++)i=e[r],s.push(o(i)?n.push(i):t.warn({invalid:i}));return s},getAll:function(){var e,t,o,i;for(t=[],o=0,i=n.length;i>o;o++)e=n[o],t.push(new e);return t},findByType:function(t){return e("filter")(this.getAll(),{type:t},!0)},findTopLevelOnly:function(){return e("filter")(this.getAll(),{topLevelOnly:!0},!0)},findNonTopLevelOnly:function(){var e,t,n,o,i;for(t=[],i=this.getAll(),n=0,o=i.length;o>n;n++)e=i[n],e.topLevelOnly||t.push(e);return t},findById:function(t){var n,o;return t?(n=this.getAll(),o=e("filter")(n,{id:t},!0),o.length>0?o[0]:null):null}}}]),angular.module("faber").factory("configService",["$rootScope",function(e){var t;return t={expanded:!0,prefix:"faber",components:[RichTextComponent,OrderedListComponent]},faber.init=this.init,{init:function(n){return angular.extend(t,n),e.$broadcast("ConfigUpdated",t)},get:function(){return t}}}]),angular.module("faber").factory("contentService",["$rootScope","$timeout","faberConfig",function(e,t,n){var o,i;return o={blocks:[]},i={init:function(e){return o=e},clear:function(){return o.blocks=[]},getAll:function(){return o.blocks},"import":function(t){var n;return n=angular.fromJson(t),angular.isArray(n)&&!e.$$phase?(o.blocks=n,e.$apply(),e.$broadcast("imported",o.blocks),!0):!1},"export":function(){var t;return t=angular.toJson(o.blocks),e.$broadcast("exported",t),t},save:function(){return angular.isDefined(Storage)?localStorage.setItem(""+(n.prefix||"faber")+".data",angular.toJson(o.blocks)):void 0},load:function(){var e;return angular.isDefined(Storage)?(e=localStorage.getItem(""+(n.prefix||"faber")+".data")||[],this["import"](e),e):[]},removeSavedData:function(){return localStorage.removeItem(""+(n.prefix||"faber")+".data")}},e.$on("BlockUpdated",i.save),i}]);