function MediumEditor(elements,options){"use strict";return this.init(elements,options)}"object"==typeof module&&(module.exports=MediumEditor),function(window,document){"use strict";function extend(b,a){var prop;if(void 0===b)return a;for(prop in a)a.hasOwnProperty(prop)&&b.hasOwnProperty(prop)===!1&&(b[prop]=a[prop]);return b}function saveSelection(){var i,len,ranges,sel=window.getSelection();if(sel.getRangeAt&&sel.rangeCount){for(ranges=[],i=0,len=sel.rangeCount;len>i;i+=1)ranges.push(sel.getRangeAt(i));return ranges}return null}function restoreSelection(savedSel){var i,len,sel=window.getSelection();if(savedSel)for(sel.removeAllRanges(),i=0,len=savedSel.length;len>i;i+=1)sel.addRange(savedSel[i])}function getSelectionStart(){var node=document.getSelection().anchorNode,startNode=node&&3===node.nodeType?node.parentNode:node;return startNode}function getSelectionHtml(){var i,sel,len,container,html="";if(void 0!==window.getSelection){if(sel=window.getSelection(),sel.rangeCount){for(container=document.createElement("div"),i=0,len=sel.rangeCount;len>i;i+=1)container.appendChild(sel.getRangeAt(i).cloneContents());html=container.innerHTML}}else void 0!==document.selection&&"Text"===document.selection.type&&(html=document.selection.createRange().htmlText);return html}function isElement(obj){return!(!obj||1!==obj.nodeType)}MediumEditor.prototype={defaults:{allowMultiParagraphSelection:!0,anchorInputPlaceholder:"Paste or type a link",anchorPreviewHideDelay:500,buttons:["bold","italic","underline","anchor","header1","header2","quote"],buttonLabels:!1,checkLinkFormat:!1,cleanPastedHTML:!1,delay:0,diffLeft:0,diffTop:-10,disableReturn:!1,disableDoubleReturn:!1,disableToolbar:!1,firstHeader:"h3",forcePlainText:!0,placeholder:"Type your text",secondHeader:"h4",targetBlank:!1,extensions:{}},isIE:"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent),init:function(elements,options){return this.elements="string"==typeof elements?document.querySelectorAll(elements):elements,1===this.elements.nodeType&&(this.elements=[this.elements]),0!==this.elements.length?(this.parentElements=["p","h1","h2","h3","h4","h5","h6","blockquote","pre"],this.id=document.querySelectorAll(".medium-editor-toolbar").length+1,this.options=extend(options,this.defaults),this.setup()):void 0},setup:function(){this.isActive=!0,this.initElements().bindSelect().bindPaste().setPlaceholders().bindWindowActions()},initElements:function(){var i,addToolbar=!1;for(i=0;i<this.elements.length;i+=1)this.elements[i].setAttribute("contentEditable",!0),this.elements[i].getAttribute("data-placeholder")||this.elements[i].setAttribute("data-placeholder",this.options.placeholder),this.elements[i].setAttribute("data-medium-element",!0),this.bindParagraphCreation(i).bindReturn(i).bindTab(i),this.options.disableToolbar||this.elements[i].getAttribute("data-disable-toolbar")||(addToolbar=!0);return addToolbar&&this.initToolbar().bindButtons().bindAnchorForm().bindAnchorPreview(),this},serialize:function(){var i,elementid,content={};for(i=0;i<this.elements.length;i+=1)elementid=""!==this.elements[i].id?this.elements[i].id:"element-"+i,content[elementid]={value:this.elements[i].innerHTML.trim()};return content},callExtensions:function(funcName){if(!(arguments.length<1)){var ext,name,args=Array.prototype.slice.call(arguments,1);for(name in this.options.extensions)this.options.extensions.hasOwnProperty(name)&&(ext=this.options.extensions[name],void 0!==ext[funcName]&&ext[funcName].apply(ext,args))}},bindParagraphCreation:function(index){var self=this;return this.elements[index].addEventListener("keyup",function(e){var tagName,node=getSelectionStart();node&&node.getAttribute("data-medium-element")&&0===node.children.length&&!self.options.disableReturn&&!node.getAttribute("data-disable-return")&&document.execCommand("formatBlock",!1,"p"),13===e.which&&(node=getSelectionStart(),tagName=node.tagName.toLowerCase(),self.options.disableReturn||this.getAttribute("data-disable-return")||"li"===tagName||self.isListItemChild(node)||(e.shiftKey||document.execCommand("formatBlock",!1,"p"),"a"===tagName&&document.execCommand("unlink",!1,null)))}),this},isListItemChild:function(node){for(var parentNode=node.parentNode,tagName=parentNode.tagName.toLowerCase();-1===this.parentElements.indexOf(tagName)&&"div"!==tagName;){if("li"===tagName)return!0;if(parentNode=parentNode.parentNode,!parentNode||!parentNode.tagName)return!1;tagName=parentNode.tagName.toLowerCase()}return!1},bindReturn:function(index){var self=this;return this.elements[index].addEventListener("keypress",function(e){if(13===e.which)if(self.options.disableReturn||this.getAttribute("data-disable-return"))e.preventDefault();else if(self.options.disableDoubleReturn||this.getAttribute("data-disable-double-return")){var node=getSelectionStart();node&&"\n"===node.innerText&&e.preventDefault()}}),this},bindTab:function(index){return this.elements[index].addEventListener("keydown",function(e){if(9===e.which){var tag=getSelectionStart().tagName.toLowerCase();"pre"===tag&&(e.preventDefault(),document.execCommand("insertHtml",null,"    "))}}),this},buttonTemplate:function(btnType){var buttonLabels=this.getButtonLabels(this.options.buttonLabels),buttonTemplates={bold:'<button class="medium-editor-action medium-editor-action-bold" data-action="bold" data-element="b">'+buttonLabels.bold+"</button>",italic:'<button class="medium-editor-action medium-editor-action-italic" data-action="italic" data-element="i">'+buttonLabels.italic+"</button>",underline:'<button class="medium-editor-action medium-editor-action-underline" data-action="underline" data-element="u">'+buttonLabels.underline+"</button>",strikethrough:'<button class="medium-editor-action medium-editor-action-strikethrough" data-action="strikethrough" data-element="strike"><strike>A</strike></button>',superscript:'<button class="medium-editor-action medium-editor-action-superscript" data-action="superscript" data-element="sup">'+buttonLabels.superscript+"</button>",subscript:'<button class="medium-editor-action medium-editor-action-subscript" data-action="subscript" data-element="sub">'+buttonLabels.subscript+"</button>",anchor:'<button class="medium-editor-action medium-editor-action-anchor" data-action="anchor" data-element="a">'+buttonLabels.anchor+"</button>",image:'<button class="medium-editor-action medium-editor-action-image" data-action="image" data-element="img">'+buttonLabels.image+"</button>",header1:'<button class="medium-editor-action medium-editor-action-header1" data-action="append-'+this.options.firstHeader+'" data-element="'+this.options.firstHeader+'">'+buttonLabels.header1+"</button>",header2:'<button class="medium-editor-action medium-editor-action-header2" data-action="append-'+this.options.secondHeader+'" data-element="'+this.options.secondHeader+'">'+buttonLabels.header2+"</button>",quote:'<button class="medium-editor-action medium-editor-action-quote" data-action="append-blockquote" data-element="blockquote">'+buttonLabels.quote+"</button>",orderedlist:'<button class="medium-editor-action medium-editor-action-orderedlist" data-action="insertorderedlist" data-element="ol">'+buttonLabels.orderedlist+"</button>",unorderedlist:'<button class="medium-editor-action medium-editor-action-unorderedlist" data-action="insertunorderedlist" data-element="ul">'+buttonLabels.unorderedlist+"</button>",pre:'<button class="medium-editor-action medium-editor-action-pre" data-action="append-pre" data-element="pre">'+buttonLabels.pre+"</button>",indent:'<button class="medium-editor-action medium-editor-action-indent" data-action="indent" data-element="ul">'+buttonLabels.indent+"</button>",outdent:'<button class="medium-editor-action medium-editor-action-outdent" data-action="outdent" data-element="ul">'+buttonLabels.outdent+"</button>"};return buttonTemplates[btnType]||!1},getButtonLabels:function(buttonLabelType){var customButtonLabels,attrname,buttonLabels={bold:"<b>B</b>",italic:"<b><i>I</i></b>",underline:"<b><u>U</u></b>",superscript:"<b>x<sup>1</sup></b>",subscript:"<b>x<sub>1</sub></b>",anchor:"<b>#</b>",image:"<b>image</b>",header1:"<b>H1</b>",header2:"<b>H2</b>",quote:"<b>&ldquo;</b>",orderedlist:"<b>1.</b>",unorderedlist:"<b>&bull;</b>",pre:"<b>0101</b>",indent:"<b>&rarr;</b>",outdent:"<b>&larr;</b>"};if("fontawesome"===buttonLabelType?customButtonLabels={bold:'<i class="fa fa-bold"></i>',italic:'<i class="fa fa-italic"></i>',underline:'<i class="fa fa-underline"></i>',superscript:'<i class="fa fa-superscript"></i>',subscript:'<i class="fa fa-subscript"></i>',anchor:'<i class="fa fa-link"></i>',image:'<i class="fa fa-picture-o"></i>',quote:'<i class="fa fa-quote-right"></i>',orderedlist:'<i class="fa fa-list-ol"></i>',unorderedlist:'<i class="fa fa-list-ul"></i>',pre:'<i class="fa fa-code fa-lg"></i>',indent:'<i class="fa fa-indent"></i>',outdent:'<i class="fa fa-outdent"></i>'}:"object"==typeof buttonLabelType&&(customButtonLabels=buttonLabelType),"object"==typeof customButtonLabels)for(attrname in customButtonLabels)customButtonLabels.hasOwnProperty(attrname)&&(buttonLabels[attrname]=customButtonLabels[attrname]);return buttonLabels},initToolbar:function(){return this.toolbar?this:(this.toolbar=this.createToolbar(),this.keepToolbarAlive=!1,this.anchorForm=this.toolbar.querySelector(".medium-editor-toolbar-form-anchor"),this.anchorInput=this.anchorForm.querySelector("input"),this.toolbarActions=this.toolbar.querySelector(".medium-editor-toolbar-actions"),this.anchorPreview=this.createAnchorPreview(),this)},createToolbar:function(){var toolbar=document.createElement("div");return toolbar.id="medium-editor-toolbar-"+this.id,toolbar.className="medium-editor-toolbar",toolbar.appendChild(this.toolbarButtons()),toolbar.appendChild(this.toolbarFormAnchor()),document.body.appendChild(toolbar),toolbar},toolbarButtons:function(){var li,i,btn,ext,btns=this.options.buttons,ul=document.createElement("ul");for(ul.id="medium-editor-toolbar-actions",ul.className="medium-editor-toolbar-actions clearfix",i=0;i<btns.length;i+=1)this.options.extensions.hasOwnProperty(btns[i])?(ext=this.options.extensions[btns[i]],btn=void 0!==ext.getButton?ext.getButton():null):btn=this.buttonTemplate(btns[i]),btn&&(li=document.createElement("li"),isElement(btn)?li.appendChild(btn):li.innerHTML=btn,ul.appendChild(li));return ul},toolbarFormAnchor:function(){var anchor=document.createElement("div"),input=document.createElement("input"),a=document.createElement("a");return a.setAttribute("href","#"),a.innerHTML="&times;",input.setAttribute("type","text"),input.setAttribute("placeholder",this.options.anchorInputPlaceholder),anchor.className="medium-editor-toolbar-form-anchor",anchor.id="medium-editor-toolbar-form-anchor",anchor.appendChild(input),anchor.appendChild(a),anchor},bindSelect:function(){var i,self=this,timer="";for(this.checkSelectionWrapper=function(e){return e&&self.clickingIntoArchorForm(e)?!1:(clearTimeout(timer),void(timer=setTimeout(function(){self.checkSelection()},self.options.delay)))},document.documentElement.addEventListener("mouseup",this.checkSelectionWrapper),i=0;i<this.elements.length;i+=1)this.elements[i].addEventListener("keyup",this.checkSelectionWrapper),this.elements[i].addEventListener("blur",this.checkSelectionWrapper);return this},checkSelection:function(){var newSelection,selectionElement;return this.keepToolbarAlive===!0||this.options.disableToolbar||(newSelection=window.getSelection(),""===newSelection.toString().trim()||this.options.allowMultiParagraphSelection===!1&&this.hasMultiParagraphs()?this.hideToolbarActions():(selectionElement=this.getSelectionElement(),!selectionElement||selectionElement.getAttribute("data-disable-toolbar")?this.hideToolbarActions():this.checkSelectionElement(newSelection,selectionElement))),this},clickingIntoArchorForm:function(e){var self=this;return e.type&&"blur"===e.type.toLowerCase()&&e.relatedTarget&&e.relatedTarget===self.anchorInput?!0:!1},hasMultiParagraphs:function(){var selectionHtml=getSelectionHtml().replace(/<[\S]+><\/[\S]+>/gim,""),hasMultiParagraphs=selectionHtml.match(/<(p|h[0-6]|blockquote)>([\s\S]*?)<\/(p|h[0-6]|blockquote)>/g);return hasMultiParagraphs?hasMultiParagraphs.length:0},checkSelectionElement:function(newSelection,selectionElement){var i;for(this.selection=newSelection,this.selectionRange=this.selection.getRangeAt(0),i=0;i<this.elements.length;i+=1)if(this.elements[i]===selectionElement)return void this.setToolbarButtonStates().setToolbarPosition().showToolbarActions();this.hideToolbarActions()},getSelectionElement:function(){var range,current,parent,result,selection=window.getSelection(),getMediumElement=function(e){var localParent=e;try{for(;!localParent.getAttribute("data-medium-element");)localParent=localParent.parentNode}catch(errb){return!1}return localParent};try{range=selection.getRangeAt(0),current=range.commonAncestorContainer,parent=current.parentNode,result=current.getAttribute("data-medium-element")?current:getMediumElement(parent)}catch(err){result=getMediumElement(parent)}return result},setToolbarPosition:function(){var buttonHeight=50,selection=window.getSelection(),range=selection.getRangeAt(0),boundary=range.getBoundingClientRect(),defaultLeft=this.options.diffLeft-this.toolbar.offsetWidth/2,middleBoundary=(boundary.left+boundary.right)/2,halfOffsetWidth=this.toolbar.offsetWidth/2;return boundary.top<buttonHeight?(this.toolbar.classList.add("medium-toolbar-arrow-over"),this.toolbar.classList.remove("medium-toolbar-arrow-under"),this.toolbar.style.top=buttonHeight+boundary.bottom-this.options.diffTop+window.pageYOffset-this.toolbar.offsetHeight+"px"):(this.toolbar.classList.add("medium-toolbar-arrow-under"),this.toolbar.classList.remove("medium-toolbar-arrow-over"),this.toolbar.style.top=boundary.top+this.options.diffTop+window.pageYOffset-this.toolbar.offsetHeight+"px"),this.toolbar.style.left=halfOffsetWidth>middleBoundary?defaultLeft+halfOffsetWidth+"px":window.innerWidth-middleBoundary<halfOffsetWidth?window.innerWidth+defaultLeft-halfOffsetWidth+"px":defaultLeft+middleBoundary+"px",this.hideAnchorPreview(),this},setToolbarButtonStates:function(){var i,buttons=this.toolbarActions.querySelectorAll("button");for(i=0;i<buttons.length;i+=1)buttons[i].classList.remove("medium-editor-button-active");return this.checkActiveButtons(),this},checkActiveButtons:function(){var elements=Array.prototype.slice.call(this.elements),parentNode=this.selection.anchorNode;for(parentNode.tagName||(parentNode=this.selection.anchorNode.parentNode);void 0!==parentNode.tagName&&-1===this.parentElements.indexOf(parentNode.tagName.toLowerCase)&&(this.activateButton(parentNode.tagName.toLowerCase()),this.callExtensions("checkState",parentNode),-1===elements.indexOf(parentNode));)parentNode=parentNode.parentNode},activateButton:function(tag){var el=this.toolbar.querySelector('[data-element="'+tag+'"]');null!==el&&-1===el.className.indexOf("medium-editor-button-active")&&(el.className+=" medium-editor-button-active")},bindButtons:function(){var i,buttons=this.toolbar.querySelectorAll("button"),self=this,triggerAction=function(e){e.preventDefault(),e.stopPropagation(),void 0===self.selection&&self.checkSelection(),this.className.indexOf("medium-editor-button-active")>-1?this.classList.remove("medium-editor-button-active"):this.className+=" medium-editor-button-active",this.hasAttribute("data-action")&&self.execAction(this.getAttribute("data-action"),e)};for(i=0;i<buttons.length;i+=1)buttons[i].addEventListener("click",triggerAction);return this.setFirstAndLastItems(buttons),this},setFirstAndLastItems:function(buttons){return buttons.length>0&&(buttons[0].className+=" medium-editor-button-first",buttons[buttons.length-1].className+=" medium-editor-button-last"),this},execAction:function(action,e){action.indexOf("append-")>-1?(this.execFormatBlock(action.replace("append-","")),this.setToolbarPosition(),this.setToolbarButtonStates()):"anchor"===action?this.triggerAnchorAction(e):"image"===action?document.execCommand("insertImage",!1,window.getSelection()):(document.execCommand(action,!1,null),this.setToolbarPosition())},triggerAnchorAction:function(){return"a"===this.selection.anchorNode.parentNode.tagName.toLowerCase()?document.execCommand("unlink",!1,null):"block"===this.anchorForm.style.display?this.showToolbarActions():this.showAnchorForm(),this},execFormatBlock:function(el){var selectionData=this.getSelectionData(this.selection.anchorNode);if("blockquote"===el&&selectionData.el&&"blockquote"===selectionData.el.parentNode.tagName.toLowerCase())return document.execCommand("outdent",!1,null);if(selectionData.tagName===el&&(el="p"),this.isIE){if("blockquote"===el)return document.execCommand("indent",!1,el);el="<"+el+">"}return document.execCommand("formatBlock",!1,el)},getSelectionData:function(el){var tagName;for(el&&el.tagName&&(tagName=el.tagName.toLowerCase());el&&-1===this.parentElements.indexOf(tagName);)el=el.parentNode,el&&el.tagName&&(tagName=el.tagName.toLowerCase());return{el:el,tagName:tagName}},getFirstChild:function(el){for(var firstChild=el.firstChild;null!==firstChild&&1!==firstChild.nodeType;)firstChild=firstChild.nextSibling;return firstChild},hideToolbarActions:function(){this.keepToolbarAlive=!1,void 0!==this.toolbar&&this.toolbar.classList.remove("medium-editor-toolbar-active")},showToolbarActions:function(){var timer,self=this;this.anchorForm.style.display="none",this.toolbarActions.style.display="block",this.keepToolbarAlive=!1,clearTimeout(timer),timer=setTimeout(function(){self.toolbar&&!self.toolbar.classList.contains("medium-editor-toolbar-active")&&self.toolbar.classList.add("medium-editor-toolbar-active")},100)},showAnchorForm:function(link_value){this.toolbarActions.style.display="none",this.savedSelection=saveSelection(),this.anchorForm.style.display="block",this.keepToolbarAlive=!0,this.anchorInput.focus(),this.anchorInput.value=link_value||""},bindAnchorForm:function(){var linkCancel=this.anchorForm.querySelector("a"),self=this;return this.anchorForm.addEventListener("click",function(e){e.stopPropagation()}),this.anchorInput.addEventListener("keyup",function(e){13===e.keyCode&&(e.preventDefault(),self.createLink(this))}),this.anchorInput.addEventListener("click",function(e){e.stopPropagation(),self.keepToolbarAlive=!0}),this.anchorInput.addEventListener("blur",function(){self.keepToolbarAlive=!1,self.checkSelection()}),linkCancel.addEventListener("click",function(e){e.preventDefault(),self.showToolbarActions(),restoreSelection(self.savedSelection)}),this},hideAnchorPreview:function(){this.anchorPreview.classList.remove("medium-editor-anchor-preview-active")},showAnchorPreview:function(anchor_el){if(this.anchorPreview.classList.contains("medium-editor-anchor-preview-active"))return!0;var halfOffsetWidth,defaultLeft,timer,self=this,buttonHeight=40,boundary=anchor_el.getBoundingClientRect(),middleBoundary=(boundary.left+boundary.right)/2;return self.anchorPreview.querySelector("i").innerHTML=anchor_el.href,halfOffsetWidth=self.anchorPreview.offsetWidth/2,defaultLeft=self.options.diffLeft-halfOffsetWidth,clearTimeout(timer),timer=setTimeout(function(){self.anchorPreview&&!self.anchorPreview.classList.contains("medium-editor-anchor-preview-active")&&self.anchorPreview.classList.add("medium-editor-anchor-preview-active")},100),self.observeAnchorPreview(anchor_el),self.anchorPreview.classList.add("medium-toolbar-arrow-over"),self.anchorPreview.classList.remove("medium-toolbar-arrow-under"),self.anchorPreview.style.top=Math.round(buttonHeight+boundary.bottom-self.options.diffTop+window.pageYOffset-self.anchorPreview.offsetHeight)+"px",self.anchorPreview.style.left=halfOffsetWidth>middleBoundary?defaultLeft+halfOffsetWidth+"px":window.innerWidth-middleBoundary<halfOffsetWidth?window.innerWidth+defaultLeft-halfOffsetWidth+"px":defaultLeft+middleBoundary+"px",this},observeAnchorPreview:function(anchorEl){var self=this,lastOver=(new Date).getTime(),over=!0,stamp=function(){lastOver=(new Date).getTime(),over=!0},unstamp=function(e){e.relatedTarget&&/anchor-preview/.test(e.relatedTarget.className)||(over=!1)},interval_timer=setInterval(function(){if(over)return!0;var durr=(new Date).getTime()-lastOver;durr>self.options.anchorPreviewHideDelay&&(self.hideAnchorPreview(),clearInterval(interval_timer),self.anchorPreview.removeEventListener("mouseover",stamp),self.anchorPreview.removeEventListener("mouseout",unstamp),anchorEl.removeEventListener("mouseover",stamp),anchorEl.removeEventListener("mouseout",unstamp))},200);self.anchorPreview.addEventListener("mouseover",stamp),self.anchorPreview.addEventListener("mouseout",unstamp),anchorEl.addEventListener("mouseover",stamp),anchorEl.addEventListener("mouseout",unstamp)},createAnchorPreview:function(){var self=this,anchorPreview=document.createElement("div");return anchorPreview.id="medium-editor-anchor-preview-"+this.id,anchorPreview.className="medium-editor-anchor-preview",anchorPreview.innerHTML=this.anchorPreviewTemplate(),document.body.appendChild(anchorPreview),anchorPreview.addEventListener("click",function(){self.anchorPreviewClickHandler()}),anchorPreview},anchorPreviewTemplate:function(){return'<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <i class="medium-editor-toolbar-anchor-preview-inner"></i></div>'},anchorPreviewClickHandler:function(){if(this.activeAnchor){var self=this,range=document.createRange(),sel=window.getSelection();range.selectNodeContents(self.activeAnchor),sel.removeAllRanges(),sel.addRange(range),setTimeout(function(){self.activeAnchor&&self.showAnchorForm(self.activeAnchor.href),self.keepToolbarAlive=!1},100+self.options.delay)}this.hideAnchorPreview()},editorAnchorObserver:function(e){var self=this,overAnchor=!0,leaveAnchor=function(){overAnchor=!1,self.activeAnchor.removeEventListener("mouseout",leaveAnchor)};if(e.target&&"a"===e.target.tagName.toLowerCase()){if(!/href=["']\S+["']/.test(e.target.outerHTML)||/href=["']#\S+["']/.test(e.target.outerHTML))return!0;if(this.toolbar.classList.contains("medium-editor-toolbar-active"))return!0;this.activeAnchor=e.target,this.activeAnchor.addEventListener("mouseout",leaveAnchor),setTimeout(function(){overAnchor&&self.showAnchorPreview(e.target)},self.options.delay)}},bindAnchorPreview:function(){var i,self=this;for(this.editorAnchorObserverWrapper=function(e){self.editorAnchorObserver(e)},i=0;i<this.elements.length;i+=1)this.elements[i].addEventListener("mouseover",this.editorAnchorObserverWrapper);return this},checkLinkFormat:function(value){var re=/^https?:\/\//;return value.match(re)?value:"http://"+value},setTargetBlank:function(){var i,el=getSelectionStart();if("a"===el.tagName.toLowerCase())el.target="_blank";else for(el=el.getElementsByTagName("a"),i=0;i<el.length;i+=1)el[i].target="_blank"},createLink:function(input){restoreSelection(this.savedSelection),this.options.checkLinkFormat&&(input.value=this.checkLinkFormat(input.value)),document.execCommand("createLink",!1,input.value),this.options.targetBlank&&this.setTargetBlank(),this.showToolbarActions(),input.value=""},bindWindowActions:function(){var timerResize,self=this;return this.windowResizeHandler=function(){clearTimeout(timerResize),timerResize=setTimeout(function(){self.toolbar&&self.toolbar.classList.contains("medium-editor-toolbar-active")&&self.setToolbarPosition()},100)},window.addEventListener("resize",this.windowResizeHandler),this},activate:function(){this.isActive||this.setup()},deactivate:function(){var i;if(this.isActive)for(this.isActive=!1,void 0!==this.toolbar&&(document.body.removeChild(this.anchorPreview),document.body.removeChild(this.toolbar),delete this.toolbar,delete this.anchorPreview),document.documentElement.removeEventListener("mouseup",this.checkSelectionWrapper),window.removeEventListener("resize",this.windowResizeHandler),i=0;i<this.elements.length;i+=1)this.elements[i].removeEventListener("mouseover",this.editorAnchorObserverWrapper),this.elements[i].removeEventListener("keyup",this.checkSelectionWrapper),this.elements[i].removeEventListener("blur",this.checkSelectionWrapper),this.elements[i].removeEventListener("paste",this.pasteWrapper),this.elements[i].removeAttribute("contentEditable"),this.elements[i].removeAttribute("data-medium-element")},htmlEntities:function(str){return String(str).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},bindPaste:function(){var i,self=this;for(this.pasteWrapper=function(e){var paragraphs,p,html="";if(this.classList.remove("medium-editor-placeholder"),!self.options.forcePlainText&&!self.options.cleanPastedHTML)return this;if(e.clipboardData&&e.clipboardData.getData&&!e.defaultPrevented){if(e.preventDefault(),self.options.cleanPastedHTML&&e.clipboardData.getData("text/html"))return self.cleanPaste(e.clipboardData.getData("text/html"));if(self.options.disableReturn)document.execCommand("insertHTML",!1,e.clipboardData.getData("text/plain"));else{for(paragraphs=e.clipboardData.getData("text/plain").split(/[\r\n]/g),p=0;p<paragraphs.length;p+=1)""!==paragraphs[p]&&(html+=navigator.userAgent.match(/firefox/i)&&0===p?self.htmlEntities(paragraphs[p]):"<p>"+self.htmlEntities(paragraphs[p])+"</p>");document.execCommand("insertHTML",!1,html)}}},i=0;i<this.elements.length;i+=1)this.elements[i].addEventListener("paste",this.pasteWrapper);return this},setPlaceholders:function(){var i,activatePlaceholder=function(el){""===el.textContent.replace(/^\s+|\s+$/g,"")&&el.classList.add("medium-editor-placeholder")},placeholderWrapper=function(e){this.classList.remove("medium-editor-placeholder"),"keypress"!==e.type&&activatePlaceholder(this)};for(i=0;i<this.elements.length;i+=1)activatePlaceholder(this.elements[i]),this.elements[i].addEventListener("blur",placeholderWrapper),this.elements[i].addEventListener("keypress",placeholderWrapper);return this},cleanPaste:function(text){var i,elList,workEl,el=this.getSelectionElement(),multiline=/<p|<br|<div/.test(text),replacements=[[new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi),""],[new RegExp(/<\/b>(<br[^>]*>)?$/gi),""],[new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g)," "],[new RegExp(/<br class="Apple-interchange-newline">/g),"<br>"],[new RegExp(/<span[^>]*(font-style:italic;font-weight:bold|font-weight:bold;font-style:italic)[^>]*>/gi),'<span class="replace-with italic bold">'],[new RegExp(/<span[^>]*font-style:italic[^>]*>/gi),'<span class="replace-with italic">'],[new RegExp(/<span[^>]*font-weight:bold[^>]*>/gi),'<span class="replace-with bold">'],[new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi),"<$1$2>"],[new RegExp(/&lt;a\s+href=(&quot;|&rdquo;|&ldquo;|“|”)([^&]+)(&quot;|&rdquo;|&ldquo;|“|”)&gt;/gi),'<a href="$2">']];for(i=0;i<replacements.length;i+=1)text=text.replace(replacements[i][0],replacements[i][1]);if(multiline)for(elList=text.split("<br><br>"),this.pasteHTML("<p>"+elList.join("</p><p>")+"</p>"),document.execCommand("insertText",!1,"\n"),elList=el.querySelectorAll("p,div,br"),i=0;i<elList.length;i+=1)switch(workEl=elList[i],workEl.tagName.toLowerCase()){case"p":case"div":this.filterCommonBlocks(workEl);break;case"br":this.filterLineBreak(workEl)}else this.pasteHTML(text)},pasteHTML:function(html){var elList,workEl,i,fragmentBody,pasteBlock=document.createDocumentFragment();for(pasteBlock.appendChild(document.createElement("body")),fragmentBody=pasteBlock.querySelector("body"),fragmentBody.innerHTML=html,this.cleanupSpans(fragmentBody),elList=fragmentBody.querySelectorAll("*"),i=0;i<elList.length;i+=1)workEl=elList[i],workEl.removeAttribute("class"),workEl.removeAttribute("style"),workEl.removeAttribute("dir"),"meta"===workEl.tagName.toLowerCase()&&workEl.parentNode.removeChild(workEl);document.execCommand("insertHTML",!1,fragmentBody.innerHTML.replace(/&nbsp;/g," "))},isCommonBlock:function(el){return el&&("p"===el.tagName.toLowerCase()||"div"===el.tagName.toLowerCase())},filterCommonBlocks:function(el){/^\s*$/.test(el.innerText)&&el.parentNode.removeChild(el)},filterLineBreak:function(el){this.isCommonBlock(el.previousElementSibling)?el.parentNode.removeChild(el):!this.isCommonBlock(el.parentNode)||el.parentNode.firstChild!==el&&el.parentNode.lastChild!==el?1===el.parentNode.childElementCount&&this.removeWithParent(el):el.parentNode.removeChild(el)},removeWithParent:function(el){el&&el.parentNode&&(el.parentNode.parentNode&&1===el.parentNode.childElementCount?el.parentNode.parentNode.removeChild(el.parentNode):el.parentNode.removeChild(el.parentNode))},cleanupSpans:function(container_el){var i,el,new_el,spans=container_el.querySelectorAll(".replace-with");for(i=0;i<spans.length;i+=1)el=spans[i],new_el=document.createElement(el.classList.contains("bold")?"b":"i"),new_el.innerHTML=el.classList.contains("bold")&&el.classList.contains("italic")?"<i>"+el.innerHTML+"</i>":el.innerHTML,el.parentNode.replaceChild(new_el,el);for(spans=container_el.querySelectorAll("span"),i=0;i<spans.length;i+=1)el=spans[i],/^\s*$/.test()?el.parentNode.removeChild(el):el.parentNode.replaceChild(document.createTextNode(el.innerText),el)}}}(window,document);var OrderedListComponent;OrderedListComponent=function(){function OrderedListComponent(){}return OrderedListComponent.prototype.name="Ordered List",OrderedListComponent.prototype.id="ordered-list",OrderedListComponent.prototype.type="group",OrderedListComponent.prototype.template='<ol class="ordered-list"> <li ng-repeat="b in block.blocks"> <faber-render data-faber-render-block="b"/> </li> </ol>',OrderedListComponent.prototype.init=function(){},OrderedListComponent}(),"document"in self&&!("classList"in document.createElement("_"))&&!function(j){"use strict";if("Element"in j){var a="classList",f="prototype",m=j.Element[f],b=Object,k=String[f].trim||function(){return this.replace(/^\s+|\s+$/g,"")},c=Array[f].indexOf||function(q){for(var p=0,o=this.length;o>p;p++)if(p in this&&this[p]===q)return p;return-1},n=function(o,p){this.name=o,this.code=DOMException[o],this.message=p},g=function(p,o){if(""===o)throw new n("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(o))throw new n("INVALID_CHARACTER_ERR","String contains an invalid character");return c.call(p,o)},d=function(s){for(var r=k.call(s.getAttribute("class")||""),q=r?r.split(/\s+/):[],p=0,o=q.length;o>p;p++)this.push(q[p]);this._updateClassName=function(){s.setAttribute("class",this.toString())}},e=d[f]=[],i=function(){return new d(this)};if(n[f]=Error[f],e.item=function(o){return this[o]||null},e.contains=function(o){return o+="",-1!==g(this,o)},e.add=function(){var q,s=arguments,r=0,p=s.length,o=!1;do q=s[r]+"",-1===g(this,q)&&(this.push(q),o=!0);while(++r<p);o&&this._updateClassName()},e.remove=function(){var r,t=arguments,s=0,p=t.length,o=!1;do{r=t[s]+"";var q=g(this,r);-1!==q&&(this.splice(q,1),o=!0)}while(++s<p);o&&this._updateClassName()},e.toggle=function(p,q){p+="";var o=this.contains(p),r=o?q!==!0&&"remove":q!==!1&&"add";return r&&this[r](p),!o},e.toString=function(){return this.join(" ")},b.defineProperty){var l={get:i,enumerable:!0,configurable:!0};try{b.defineProperty(m,a,l)}catch(h){-2146823252===h.number&&(l.enumerable=!1,b.defineProperty(m,a,l))}}else b[f].__defineGetter__&&m.__defineGetter__(a,i)}}(self);var MediumEditorExtended,RichTextComponent,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};MediumEditorExtended=function(_super){function MediumEditorExtended(elements,options){this.defaults.firstHeader="h1",this.defaults.secondHeader="h2",this.init(elements,options)}return __extends(MediumEditorExtended,_super),MediumEditorExtended.prototype.init=function(elements,options){return MediumEditorExtended.__super__.init.call(this,elements,options)},MediumEditorExtended.prototype.buttonTemplate=function(btnType){var buttonTemplates;
return buttonTemplates={header3:'<li><button class="medium-editor-action medium-editor-action-header3" data-action="append-h3" data-element="h3">H3</button></li>'},MediumEditorExtended.__super__.buttonTemplate.call(this,btnType)||buttonTemplates[btnType]},MediumEditorExtended}(MediumEditor),RichTextComponent=function(){function RichTextComponent(){}return RichTextComponent.prototype.name="Rich Text",RichTextComponent.prototype.id="rich-text",RichTextComponent.prototype.type="element",RichTextComponent.prototype.template='<div class="rich-text-editor" data-tust-html><br/></div>',RichTextComponent.prototype.editor=null,RichTextComponent.prototype.editorInstance=null,RichTextComponent.prototype.init=function($scope,$element,initialContent,update){var opts;return opts={buttons:["bold","italic","underline","anchor","unorderedlist","orderedlist","header1","header2","header3","quote"],placeholder:"Type your text"},this.editor=$element[0].getElementsByClassName("rich-text-editor")[0],this.editor.innerHTML=initialContent||"",this.editorInstance=new MediumEditorExtended(this.editor,opts),this.editor.addEventListener("input",function(_this){return function(){return update(_this.editor.innerHTML)}}(this))},RichTextComponent.prototype.selected=function($scope,$element){return $element[0].getElementsByClassName("rich-text-editor")[0].focus()},RichTextComponent.prototype.unselected=function($scope,$element,update){return update(this.editor.innerHTML)},RichTextComponent}();var FaberComponent;FaberComponent=function(){function FaberComponent(opts){null==opts&&(opts=[]),this.id=opts.id||"",this.name=opts.name||"",this.type=opts.type||"group",this.template=opts.template||"",this.topLevelOnly="group"===opts.type&&(opts.topLevelOnly===!0||void 0===opts.topLevelOnly)}return FaberComponent.prototype.id="",FaberComponent.prototype.name="",FaberComponent.prototype.type="group",FaberComponent.prototype.template="",FaberComponent.prototype.topLevelOnly=!1,FaberComponent.prototype.init=function(){},FaberComponent.prototype.selected=function(){},FaberComponent.prototype.unselected=function(){},FaberComponent}(),window.faber=angular.extend(angular.module("faber",["ngAnimate"]).value("faberConfig",{}).run(function(configService,contentService){return faber["import"]=contentService["import"],faber["export"]=contentService["export"],faber.init=configService.init,faber.init(faber.initialConfig)}),{init:function(config){return this.initialConfig=config},listen:function(type,method,scope,context){var handlers,listeners;return(listeners=this.listeners)||(listeners=this.listeners={}),(handlers=listeners[type])||(handlers=listeners[type]=[]),scope=null!=scope?scope:{scope:window},handlers.push({method:method,scope:scope,context:null!=context?context:{context:scope}})},stopListening:function(type,handler){var handlers,listeners;if((listeners=this.listeners)&&(handlers=listeners[type]))return handlers.splice(handlers.indexOf(handler),1)},fire:function(type,data,context){var handler,handlers,listeners,_i,_len;if((listeners=this.listeners)&&(handlers=listeners[type])){for(_i=0,_len=handlers.length;_len>_i;_i++)if(handler=handlers[_i],(typeof context!==!1||context!==!handler.context)&&handler.method.call(type,data)===!1)return!1;return!0}}}),angular.module("faber").animation(".faber-block-repeat",function($window,$document,$rootElement,$interval){var getEnd;return getEnd=function(el){var pos;if(pos=0,el.offsetParent)for(;;)if(pos+=el.offsetTop,el=el.offsetParent,!el)break;return Math.max(pos,0)},{move:function($element){var distance,end,start;return start=$window.pageYOffset,end=getEnd($element[0])-40,distance=end-start,$interval.cancel($window.faberBlockRepeatAnimationWatch),$window.faberBlockRepeatAnimationWatch=$interval(function(){return distance/=2,$window.scrollBy(0,distance),Math.abs(distance)<=1?$interval.cancel($window.faberBlockRepeatAnimationWatch):void 0},50),null}}}),angular.module("faber").controller("BlockController",function($rootScope,$scope,$log,componentsService){return $scope.block||($scope.block={}),$scope.components=componentsService.getAll(),$scope.component=null,$scope.validateBlock=function(block){var component,isTopLevelScope,result;return result=!0,angular.isString(block.component)?component=componentsService.findById(block.component):angular.isObject(block.component)&&angular.isString(block.component.id)&&(component=componentsService.findById(block.component.id)),component?(isTopLevelScope=$scope.isTopLevel,result&=!component.topLevelOnly||component.topLevelOnly&&isTopLevelScope,result&=!block.inputs||angular.isObject(block.inputs)):!1},$scope.add=function(block){var _base;return $scope.validateBlock(block)?((_base=$scope.block).blocks||(_base.blocks=[]),$scope.block.blocks.push(block),!0):($log.warn({"cannot find a component of the given name":block.component}),!1)},$scope.remove=function(block){return confirm("Are you sure you want to permanently remove this block?\n\nYou can't undo this action.")?($scope.block.blocks.splice($scope.block.blocks.indexOf(block),1),$rootScope.$broadcast("BlockUpdated")):void 0},$scope.insert=function(index,block){return $scope.validateBlock(block)?$scope.block.blocks.splice(index,0,block):void 0},$scope.insertGroup=function(index){return $scope.block.blocks.splice(index,0,{component:componentsService.findByType("group")[0].id})},$scope.move=function(from,to){var max;return max=$scope.block.blocks.length,from>=0&&max>from&&to>=0&&max>to?($scope.block.blocks.splice(to,0,$scope.block.blocks.splice(from,1)[0]),$scope.$broadcast("BlockMoved"),$rootScope.$broadcast("BlockUpdated")):void 0},$scope.$watch("block.component",function(val){var component;return val?(component=componentsService.findById(val),!component&&componentsService.getAll().length>0?$log.warn({"cannot find a component of the given name":val}):($scope.component=component||new FaberComponent,$rootScope.$broadcast("BlockUpdated"))):void 0}),$scope.$watch("block.content",function(){return $rootScope.$broadcast("BlockUpdated")}),$scope.$watch("block.blocks",function(){return $rootScope.$broadcast("BlockUpdated")})}),angular.module("faber").controller("EditorController",function($rootScope,$scope,$controller,$log,configService,contentService,componentsService){var configEditor,validateElementBlock,validateGroupBlock,validateImported;return configEditor=function(config){return $rootScope.isExpanded=angular.isDefined(config.expanded)?config.expanded:!0,componentsService.init(config.components||[]),$scope.components=componentsService.getAll()},$controller("BlockController",{$scope:$scope}),$scope.isTopLevel=!0,$scope.block.blocks=[],contentService.init($scope.block),configEditor(configService.get()),validateElementBlock=function(block){var _ref;return $scope.validateBlock(block&&(null!=(_ref=block.blocks)?_ref.length:void 0)>0)&&(block.blocks=validateImported(block.blocks)),block},validateGroupBlock=function(block){var groupItem,_i,_len,_ref,_ref1,_ref2;if((null!=(_ref=block.blocks)?_ref.length:void 0)>0)for(_ref1=block.blocks,_i=0,_len=_ref1.length;_len>_i;_i++)groupItem=_ref1[_i],(null!=(_ref2=groupItem.blocks)?_ref2.length:void 0)>0&&(groupItem.blocks=validateImported(groupItem.blocks));return block},validateImported=function(blocks){var block,component,validated,_i,_len;for(validated=[],_i=0,_len=blocks.length;_len>_i;_i++)block=blocks[_i],component=componentsService.findById(block.component),component?("element"===component.type&&validated.push(validateElementBlock(block)),"group"===component.type&&validated.push(validateGroupBlock(block))):$log.warn({"cannot find a component with the given id":block.component});return validated},$scope.$on("imported",function(evt,blocks){return $scope.$apply(function(){return $scope.block.blocks=validateImported(blocks)})}),$scope.$on("ConfigUpdated",function(evt,config){return configEditor(config)}),$rootScope.$on("BlockUpdated",function(){return angular.module("faber").fire("BlockUpdated",angular.copy($scope.block))})}),angular.module("faber").controller("ElementBlockController",function($controller,$scope){var _base;return $controller("BlockController",{$scope:$scope}),(_base=$scope.block).content||(_base.content="")}),angular.module("faber").controller("GroupBlockController",function($rootScope,$controller,$scope,componentsService){var _base;return $controller("BlockController",{$scope:$scope}),(_base=$scope.block).blocks||(_base.blocks=[]),$scope.components=[{name:"Item",id:"group-item",template:""}],$scope.groupComponents=componentsService.findByType("group"),$scope.insertGroupItem=function(index){var groupItem;return groupItem={blocks:[]},$scope.block.blocks.splice(index,0,groupItem)}}),angular.module("faber").controller("GroupItemBlockController",function($rootScope,$controller,$scope,componentsService){var _base;return $controller("BlockController",{$scope:$scope}),(_base=$scope.block).blocks||(_base.blocks=[]),$scope.components=componentsService.findByType("element")}),angular.module("faber").directive("faberBlock",function($rootScope,$compile,$timeout){var isEventTargetSelect;return isEventTargetSelect=function(evt){return evt&&evt.target&&"select"===evt.target.tagName.toLowerCase()},{scope:{block:"=faberBlockContent"},restrict:"E",templateUrl:"faber-block.html",controller:"BlockController",compile:function($element,$attrs,transclude){var compiledContents,contents;return contents=$element.contents().remove(),compiledContents=null,{pre:function($scope,$element){return compiledContents||(compiledContents=$compile(contents,transclude)),compiledContents($scope,function(clone){return $element.append(clone)})},post:function($scope,$element){return $scope.currentIndex=$scope.$parent.$index,$scope.isExpanded=!!$rootScope.isExpanded,$scope.isSelected=!1,$scope.isMoving=!1,$scope.isPreview=!1,$scope.isGroupBlock=!1,$scope.isGroupItemBlock=!1,$scope.isElementBlock=!1,$scope.isMouseHover=!1,$scope.mouseOver=function(){return $scope.isMouseHover=!0},$scope.mouseOut=function(evt){return isEventTargetSelect(evt)?void 0:$scope.isMouseHover=!1},$scope.indexRange=function(){var i,max,min,res,_i;for(res=[],min=0,max=$scope.$parent&&$scope.$parent.block&&$scope.$parent.block.blocks?Math.max($scope.$parent.block.blocks.length-1,min):min,i=_i=min;max>=min?max>=_i:_i>=max;i=max>=min?++_i:--_i)res.push(i);return res},$scope.onSelectChange=function(){var to;return to=$element.find("select").val(),to>=0?($scope.moveSelf(to),$rootScope.$broadcast("ResetIsMoving"),$timeout(function(){return $scope.isMoving=!0})):void 0},$scope.onBlockClick=function(evt){return evt&&evt.stopPropagation(),isEventTargetSelect(evt)?void 0:($rootScope.$broadcast("ShowComponents",null),$rootScope.$broadcast("SelectBlockOfIndex",$scope.$parent,$scope.$parent.block.blocks.indexOf($scope.block)))},$scope.select=function(){return $scope.isSelected=!0},$scope.unselect=function(){return $scope.isSelected=!1},$scope.removeSelf=function(){return $scope.$parent.remove($scope.block)},$scope.moveSelf=function(to){return $scope.$parent.move($scope.$parent.block.blocks.indexOf($scope.block),to)},$scope.edit=function(evt){return evt&&evt.stopPropagation(),$scope.isGroupBlock?($scope.isPreview=!1,$rootScope.$broadcast("ResetIsMoving"),$scope.$broadcast("BlockModeChanged",$scope.isPreview)):void 0},$scope.preview=function(evt){return evt&&evt.stopPropagation(),$scope.isGroupBlock?($scope.isPreview=!0,$scope.$broadcast("BlockModeChanged",$scope.isPreview)):void 0},$scope.expand=function(evt){return evt&&evt.stopPropagation(),$scope.isGroupItemBlock?$scope.isExpanded=!0:void 0},$scope.collapse=function(evt){return evt&&evt.stopPropagation(),$scope.isGroupItemBlock?$scope.isExpanded=!1:void 0},$scope.$on("ResetIsMoving",function(){return $scope.isMoving=!1}),$scope.$on("SelectBlockOfIndex",function(evt,scope,index){return scope?scope.block.blocks[index]===$scope.block?$scope.select():$scope.unselect():void $scope.unselect()}),$scope.$on("PreviewAll",function(){return $scope.preview()}),$scope.$on("CollapseAll",function(){return $scope.isExpanded=!1}),$scope.$on("ExpandAll",function(){return $scope.isExpanded=!0}),$scope.$watchCollection("[$parent.component, component]",function(){return $scope.isElementBlock=$scope.isGroupBlock=$scope.isGroupItemBlock=!1,$scope.$parent.component&&"group"===$scope.$parent.component.type?$scope.isGroupItemBlock=!0:$scope.component&&("element"===$scope.component.type&&($scope.isElementBlock=!0),"group"===$scope.component.type)?$scope.isGroupBlock=!0:void 0})}}}}}),angular.module("faber").directive("faberComponentRenderer",function($compile,componentsService){return{restrict:"AE",template:'<div ng-class="component.id"></div>',scope:{block:"=faberComponentRendererBlock",checkGroupPreview:"&faberGroupPreview"},link:function($scope,$element){var setComponent;return $scope.isGroupPreview=$scope.checkGroupPreview()||!1,$scope.isSelected=!1,setComponent=function(content){var $component,template,wrapper;return template=$scope.component.template,$component=$compile(template)($scope),wrapper=$element.find("div"),wrapper.empty(),$element.find("div").append($component),$scope.component.init&&("element"===$scope.component.type&&$scope.component.init($scope,$element,content,$scope.updateRendered),"group"===$scope.component.type)?$scope.component.init($scope,$element,content):void 0},$scope.component=null,$scope.selectRendered=function(){return $scope.isSelected=!0,$scope.component.selected?$scope.component.selected($scope,$element,$scope.updateRendered):void 0},$scope.unselectRendered=function(){return $scope.isSelected=!1,$scope.component.unselected?$scope.component.unselected($scope,$element,$scope.updateRendered):void 0},$scope.updateRendered=function(content){return content?$scope.block.content=content:void 0},$scope.$watch("block.component",function(){var initialContent;if($scope.block)return $scope.component=componentsService.findById($scope.block.component),$scope.block.component&&$scope.component?(initialContent="element"===$scope.component.type?$scope.block.content:angular.copy($scope.block.blocks),setComponent(initialContent)):void 0}),$scope.$on("BlockModeChanged",function(){return setComponent($scope.block.content)}),$scope.$on("SelectBlockOfIndex",function(evt,scope,index){return scope?scope.block.blocks[index]===$scope.block?$scope.selectRendered():$scope.isSelected?$scope.unselectRendered():void 0:void($scope.isSelected&&$scope.unselectRendered())})}}}),angular.module("faber").directive("faberComponents",function($rootScope,$filter,$timeout){var buttonClickWithIndexReturn;return buttonClickWithIndexReturn=function(evt,$scope){return evt&&evt.stopPropagation(),$rootScope.$broadcast("SelectBlockOfIndex",null),$scope.showingComponents=!1,$scope.$index+1||0},{restrict:"AE",templateUrl:"faber-components.html",link:function($scope){return $scope.showingComponents=0===$scope.block.blocks.length,$scope.hasGroupComponents=function(){var groupComponents;return groupComponents=$filter("filter")($scope.components,{type:"group"},!0),groupComponents.length>0},$scope.$watch("showingComponents",function(newValue){return newValue?$rootScope.$broadcast("ShowComponents",$scope.$id):void 0}),$scope.$watch("isExpanded",function(val){if($scope.isGroupItemBlock){if(!val)return $scope.showingComponents=!1;if(0===$scope.block.blocks.length)return $scope.showingComponents=!0}}),$scope.$on("ShowComponents",function(evt,id){return id!==$scope.$id?$scope.showingComponents=!1:void 0}),$scope.insertBlock=function(evt,comp){var index;return evt&&evt.stopPropagation(),$scope.showingComponents=!1,index=$scope.isExpanded?$scope.$index+1||0:$scope.block.blocks.length,$scope.isGroupItemBlock&&$scope.expand(),$scope.insert(index,comp),$timeout(function(){return $rootScope.$broadcast("SelectBlockOfIndex",$scope,index)})},$scope.insertGroupBlock=function(evt){return $scope.insertGroup(buttonClickWithIndexReturn(evt,$scope))},$scope.insertGroupItemBlock=function(evt){return $scope.insertGroupItem(buttonClickWithIndexReturn(evt,$scope))},$scope.toggleComponents=function(evt){return evt&&evt.stopPropagation(),$scope.showingComponents=!$scope.showingComponents}}}}),angular.module("faber").directive("faberEditor",function($rootScope,$document,$timeout){return{restrict:"AE",templateUrl:"faber-editor.html",controller:"EditorController",link:function($scope,$element){return $document[0].addEventListener("click",function(evt){var el,isInside;for(isInside=!1,el=evt.target;el&&el.tagName&&"body"!==el.tagName.toLowerCase();){if(el===$element[0]){isInside=!0;break}el=el.parentNode}return isInside?void 0:$rootScope.$apply(function(){return $rootScope.$broadcast("ShowComponents",null),$rootScope.$broadcast("SelectBlockOfIndex",null)})},!0),$scope.$on("imported",function(){return $element.css("display","none"),$timeout(function(){return $rootScope.$broadcast("ShowComponents",null),$rootScope.$broadcast("PreviewAll"),$rootScope.$broadcast("CollapseAll"),$element.css("display","block")})}),$rootScope.$watch("isExpanded",function(){return $rootScope.$broadcast($rootScope.isExpanded?"ExpandAll":"CollapseAll")})}}}),angular.module("faber").directive("faberElementBlock",function(){return{restrict:"E",templateUrl:"faber-element-block.html",controller:"ElementBlockController"}}),angular.module("faber").directive("faberGroupBlock",function(){return{restrict:"E",templateUrl:"faber-group-block.html",controller:"GroupBlockController",link:function($scope){return $scope.$watch("component",function(val){return val?$scope.currentComponent=val.id:void 0}),$scope.$watch("currentComponent",function(val){var _ref;return val!==(null!=(_ref=$scope.component)?_ref.id:void 0)?($scope.block.component=val,$scope.isSelected=!0):void 0})}}}),angular.module("faber").directive("faberGroupItemBlock",function(){return{restrict:"E",templateUrl:"faber-group-item-block.html",controller:"GroupItemBlockController",link:function($scope,$element){return $element[0].querySelector(".faber-group-item-title input").focus()}}}),angular.module("faber").directive("faberRender",function(){return{restrict:"AE",templateUrl:"faber-render.html",scope:{data:"=faberRenderBlock"},link:function($scope){return $scope.isGroupPreview=function(){return!0}}}}),angular.module("faber").directive("trustHtml",function($sce){return{replace:!0,restrict:"M",template:'<div ng-bind-html="trustedHtml"></div>',link:function($scope,$element,attrs){return $scope.$watch(attrs.trustHtml,function(newValue,oldValue){return null!=newValue!==oldValue?$scope.trustedHtml=$sce.trustAsHtml(newValue):void 0})}}}),angular.module("faber").run(["$templateCache",function($templateCache){$templateCache.put("faber-block.html",'<div ng-class="{\'faber-element-block\': isElementBlock, \'faber-group-block\': isGroupBlock, \'faber-group-item-block\': isGroupItemBlock, \'faber-block-preview\': isPreview,\'faber-block-hover\': isMouseHover, \'faber-block-selected\': isSelected, \'faber-block-moving\': isMoving}" ng-mouseover="mouseOver($event)" ng-mouseout="mouseOut($event)" ng-click="onBlockClick($event)" class="faber-block-item"><div class="faber-block-actions"><div ng-if="isGroupBlock" class="faber-group-block-actions"><button title="Edit" ng-if="isPreview" ng-click="edit($event)" class="faber-edit-group-button faber-icon-edit toggled-on"></button><button title="Preview" ng-if="!isPreview" ng-click="preview($event)" class="faber-preview-group-button faber-icon-edit"></button></div><div ng-if="isGroupItemBlock" class="faber-group-item-block-actions"><button title="Expand" ng-if="!isExpanded" ng-click="expand($event)" class="faber-icon-plus"></button><button title="Collapse" ng-if="isExpanded" ng-click="collapse($event)" class="faber-icon-minus"></button></div><label class="faber-select faber-block-position"><select ng-model="$parent.$index" ng-options="i as (i == $parent.$index ? (i+1)+\' (current)\' : i+1) for i in indexRange()" ng-change="onSelectChange()"></select><button title="Change order" class="faber-icon-sort"></button></label><button title="Remove" ng-click="removeSelf()" class="faber-icon-remove"></button></div><faber-group-item-block ng-if="isGroupItemBlock"></faber-group-item-block><faber-element-block ng-if="isElementBlock"></faber-element-block><faber-group-block ng-if="isGroupBlock" ng-class="{\'faber-group-block-preview\': isPreview}"></faber-group-block></div>'),$templateCache.put("faber-components.html",'<div ng-click="toggleComponents($event)"><div ng-if="!showingComponents" class="faber-components-line"></div><i ng-if="!showingComponents" class="faber-icon-plus"></i><ul ng-if="showingComponents" class="faber-available-components"><li ng-repeat="comp in components | filter : {type: \'element\'}" class="faber-component"><button ng-click="insertBlock($event, {component: comp.id })">{{comp.name}}</button></li><li ng-if="hasGroupComponents()" class="faber-component"><button ng-click="insertGroupBlock($event)" class="faber-group-button"><span class="faber-icon-group"></span>Group</button></li><li ng-if="component.type == \'group\'" class="faber-component"><button ng-click="insertGroupItemBlock($event)" class="faber-group-button">Item</button></li></ul></div>'),$templateCache.put("faber-editor.html",'<faber-components></faber-components><div class="faber-blocks"><div ng-repeat="data in block.blocks" class="faber-block-repeat"><faber-block data-faber-block-content="data"></faber-block><faber-components></faber-components></div></div>'),$templateCache.put("faber-element-block.html",'<faber-component-renderer data-faber-component-renderer-block="block"></faber-component-renderer>'),$templateCache.put("faber-group-block.html",'<label ng-hide="isPreview" class="faber-select faber-group-component"><span>{{component.name}}<select ng-model="currentComponent" ng-options="c.id as c.name for c in groupComponents"></select><i class="faber-icon-button faber-icon-arrow-down"></i></span></label><faber-component-renderer data-faber-component-renderer-block="block" ng-if="isPreview"></faber-component-renderer><faber-components ng-if="!isPreview"></faber-components><div ng-hide="isPreview" class="faber-blocks"><div ng-repeat="data in block.blocks" class="faber-block-repeat"><faber-block data-faber-block-content="data"></faber-block><faber-components></faber-components></div></div>'),$templateCache.put("faber-group-item-block.html",'<label class="faber-group-item-title"><input type="text" placeholder="Type the item\'s title" ng-model="block.title"/></label><faber-components ng-if="isExpanded"></faber-components><div ng-if="isExpanded" class="faber-blocks"><div ng-repeat="data in block.blocks" class="faber-block-repeat"><faber-block data-faber-block-content="data"></faber-block><faber-components></faber-components></div></div>'),$templateCache.put("faber-render.html",'<div ng-repeat="block in data.blocks" ng-if="data"><faber-component-renderer data-faber-component-renderer-block="block" data-faber-group-preview="isGroupPreview()"></faber-component-renderer></div>')}]),angular.module("faber").factory("componentsService",function($filter,$log){var raws,validate;return raws=[],validate=function(component){var comp;return comp=new component,angular.isString(comp.id)&&("element"===comp.type||"group"===comp.type)},{init:function(list){var comp,_i,_len,_results;for(raws=[],_results=[],_i=0,_len=list.length;_len>_i;_i++)comp=list[_i],_results.push(validate(comp)?raws.push(comp):$log.warn({invalid:comp}));return _results},getAll:function(){var comp,res,_i,_len;for(res=[],_i=0,_len=raws.length;_len>_i;_i++)comp=raws[_i],res.push(new comp);return res},findByType:function(type){return $filter("filter")(this.getAll(),{type:type},!0)},findTopLevelOnly:function(){return $filter("filter")(this.getAll(),{topLevelOnly:!0},!0)},findNonTopLevelOnly:function(){var comp,result,_i,_len,_ref;for(result=[],_ref=this.getAll(),_i=0,_len=_ref.length;_len>_i;_i++)comp=_ref[_i],comp.topLevelOnly||result.push(comp);return result},findById:function(id){var all,res;return id?(all=this.getAll(),res=$filter("filter")(all,{id:id},!0),res.length>0?res[0]:null):null}}}),angular.module("faber").factory("configService",function($rootScope){var config;return config={expanded:!0,prefix:"faber",components:[RichTextComponent,OrderedListComponent]},faber.init=this.init,{init:function(newConfig){return angular.extend(config,newConfig),$rootScope.$broadcast("ConfigUpdated",config)},get:function(){return config}}}),angular.module("faber").factory("contentService",function($rootScope,faberConfig){var content,service;return content={blocks:[]},service={init:function(initial){return content=initial},clear:function(){return content.blocks=[]},getAll:function(){return content.blocks},"import":function(json){var imported;return imported=angular.fromJson(json),angular.isArray(imported)?(content.blocks=imported,$rootScope.$broadcast("imported",content.blocks),!0):!1},"export":function(){var json;return json=angular.toJson(content.blocks),$rootScope.$broadcast("exported",json),json},save:function(){return angular.isDefined(Storage)?localStorage.setItem(""+(faberConfig.prefix||"faber")+".data",angular.toJson(content.blocks)):void 0},load:function(){var json;return angular.isDefined(Storage)?(json=localStorage.getItem(""+(faberConfig.prefix||"faber")+".data")||[],this["import"](json),json):[]},removeSavedData:function(){return localStorage.removeItem(""+(faberConfig.prefix||"faber")+".data")}},$rootScope.$on("BlockUpdated",service.save),service});